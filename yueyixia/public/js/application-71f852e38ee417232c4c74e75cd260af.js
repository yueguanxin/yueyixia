$(function(){var b=function(a){for(var c=0,b=0;b<a.length;b++)c=128>a.charCodeAt(b)?c+.5:c+1;return c};jQuery.validator.addMethod("isMobile",function(a,c){var b=a.length,d=/^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1}))+\d{8})$/;return this.optional(c)||11==b&&d.test(a)},"\u8bf7\u6b63\u786e\u586b\u5199\u60a8\u7684\u624b\u673a\u53f7\u7801");jQuery.validator.addMethod("isTelephone",function(a,c){var b=/^\d{3,4}-?\d{7,9}$/;return this.optional(c)||b.test(a)},"\u8bf7\u6b63\u786e\u586b\u5199\u60a8\u7684\u7535\u8bdd\u53f7\u7801");
jQuery.validator.addMethod("isPhone",function(a,c){var b=/^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1})|(17[0-9]{1}))+\d{8})$/,d=/^\d{3,4}-?\d{7,9}$/;return this.optional(c)||d.test(a)||b.test(a)},"\u8bf7\u6b63\u786e\u586b\u5199\u60a8\u7684\u8054\u7cfb\u7535\u8bdd");jQuery.validator.addMethod("zhRangeLength",function(a,c,e){a=b(a);return this.optional(c)||a>=e[0]&&a<=e[1]},jQuery.format("\u8bf7\u786e\u4fdd\u8f93\u5165\u7684\u503c\u5728 {0}-{1} \u4e2a\u5b57\u7b26\u4e4b\u95f4(\u82f1\u6587\u8ba1\u534a\u4e2a\u5b57\u7b26)"));
jQuery.validator.addMethod("zhMinLength",function(a,c,e){a=b(a);return this.optional(c)||a>=e},jQuery.format("\u8bf7\u786e\u4fdd\u8f93\u5165\u7684\u503c\u5927\u4e8e {0} \u4e2a\u5b57\u7b26(\u82f1\u6587\u8ba1\u534a\u4e2a\u5b57\u7b26)"));jQuery.validator.addMethod("zhMaxLength",function(a,c,e){a=b(a);return this.optional(c)||a<=e},jQuery.format("\u8bf7\u786e\u4fdd\u8f93\u5165\u7684\u503c\u5c0f\u4e8e{0}\u4e2a\u5b57\u7b26(\u82f1\u6587\u8ba1\u534a\u4e2a\u5b57\u7b26)"));jQuery.validator.addMethod("checkDataMax",
function(a,c,b){a=+a;b=+$(c).data(b);b=isNaN(b)||0==b||a<=b;return this.optional(c)||b},jQuery.format("\u8d85\u8fc7\u5141\u8bb8\u7684\u6700\u5927\u503c\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165"))});
$(function(){$.validator.setDefaults({errorPlacement:function(b,a){b.appendTo(a.parent())},onkeyup:!1});$("#new_order").validate({rules:{"order[people_count]":{checkDataMax:"max-num"},"order[append_count]":{checkDataMax:"max-num"},tos:{required:!0}},messages:{tos:{required:"\u8bf7\u786e\u8ba4\u540c\u610f\u670d\u52a1\u534f\u8bae"}}});$(".coupon_input_form").each(function(){$(this).validate({rules:{coupon_code:{maxlength:16,minlength:16}}})});$(".coupon_code_input").live("change",function(){$(".coupon_input_form").each(function(){$(this).validate({rules:{coupon_code:{maxlength:16,
minlength:16}}})})});$.validator.addClassRules("js_validate_time_group_name",{required:!0});$.validator.addClassRules("js_validate_room_price_date",{required:!0});$.validator.addClassRules("js_validate_admin_house_price",{required:!0});$.validator.addClassRules("js_validate_retailer_center_date",{required:!0});$(".js_admin_house_holiday_form").validate();$(".js_admin_house_default_price_form").validate();$(".js_admin_house_special_price_form").validate();$(".js_retailer_center_quick_mode_query_form").validate();
$(".order_process_waiter").each(function(){$(this).validate({rules:{"order_process[waiter_name]":{required:!0},"order_process[waiter_cellphone]":{required:!0}}})});$(".order_waiter_submit",".order_reprocess_waiter").live("click",function(){$(".order_reprocess_waiter").validate({rules:{"order_process[waiter_name]":{required:!0},"order_process[waiter_cellphone]":{required:!0}}})});$(".edit_tour_form").validate({rules:{"tour[title]":{required:!0,zhRangeLength:[4,21]},"tour[slogan]":{required:!0},"tour[description]":{required:!0,
zhMinLength:20},"tour[cost]":{required:!0,digits:!0},"tour[duration]":{required:!0},"tour[tos]":{required:!0}}});$(".edit_promotion_form").validate({rules:{"promotion[title]":{required:!0,zhRangeLength:[5,21]},"promotion[description]":{required:!0,zhMinLength:20}}});$(".edit_promotion_item_form").validate({rules:{"promotion_item[title]":{required:!0,zhRangeLength:[1,21]},"promotion_item[intro]":{required:!0,zhRangeLength:[1,21]},"promotion_item[description]":{required:!0,zhMinLength:20},"promotion_item[price]":{required:!0,
digits:!0}}});$(".edit_house_form").validate({rules:{"house[name]":{required:!0,zhRangeLength:[2,20]},"house[description]":{required:!0,zhMinLength:20},"house[tos]":{required:!0},"house[city_id]":{required:!0,digits:!0}}});$(".edit_room_form").validate({rules:{"room[name]":{required:!0},"room[number]":{required:!0,digits:!0},"room[normal_price]":{required:!0,digits:!0},"room[resource_price_attributes][cost_price]":{required:!0,digits:!0}}});$(".edit_retailer_form").validate({rules:{"retailer[real_name]":{required:!0},
"retailer[email]":{required:!0,email:!0}}});$(".forgot_pwd_form").validate({rules:{"user[email]":{required:!0,email:!0}}});$(".reset_pwd_form").validate({rules:{"user[password]":{required:!0,minlength:6},"user[password_confirmation]":{equalTo:"#user_password"}}});$(".signup_form").validate({rules:{"user[email]":{required:!0,email:!0,remote:{url:"/users/register_form_check",type:"get"}},"user[password]":{required:!0,minlength:6},"user[password_confirmation]":{equalTo:"#user_password"},"user[nickname]":{required:!0,
zhRangeLength:[2,15],remote:{url:"/users/register_form_check",type:"get"}},tos:"required"},messages:{"user[email]":{remote:"\u8be5\u7535\u5b50\u90ae\u7bb1\u5730\u5740\u5df2\u5b58\u5728"},"user[nickname]":{remote:"\u8be5\u6635\u79f0\u5df2\u5b58\u5728/\u4e0d\u5408\u6cd5"}},onkeyup:!1});$(".new_user_retailer_form").validate({rules:{"user[email]":{required:!0,email:!0},"user[password]":{required:!0,minlength:6},"user[password_confirmation]":{equalTo:"#user_password"},"user[nickname]":{required:!0,zhRangeLength:[2,
15]},"retailer[real_name]":{required:!0},"retailer[cellphone]":{isPhone:!0},"retailer[phone]:":{isPhone:!0},"retailer[email]":{required:!0,email:!0}}});$(".login_form").validate({rules:{"user[email]":{required:!0,email:!0},"user[password]":{required:!0,minlength:6}}});$("#new_trip").validate({rules:{"trip[title]":{required:!0,zhRangeLength:[5,21]}}});$("#edit_trip").validate({rules:{"trip[title]":{required:!0,zhRangeLength:[5,21]}}});$(".profile_form").validate({rules:{"user[nickname]":{required:!0,
zhRangeLength:[2,8]},"user[avatar]":{required:!0},"user[password]":{required:!0,minlength:6},"user[password_confirmation]":{equalTo:"#user_password"}}});$("#edit_itinerary_form").validate({rules:{"itinerary[name]":{required:!0},"itinerary[country_id]":{required:!0,digits:!0},"itinerary[desc]":{required:!0,zhMinLength:20}}});$("#new_comment").validate({rules:{"comment[content]":{required:!0}},messages:{"comment[content]":"\u8bc4\u8bba\u4e0d\u80fd\u4e3a\u7a7a"},onkeyup:!0});$("#new_rate").validate({rules:{"rate[content]":{required:!0},
"score[composite]":{required:!0}},messages:{"rate[content]":"\u70b9\u8bc4\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a","score[composite]":"\u7ed9\u6253\u4e2a\u5206\u5427~"},onkeyup:!0});$("#new_rate_reply").validate({rules:{"rate_reply[content]":{required:!0}},messages:{"rate_reply[content]":"\u56de\u590d\u4e0d\u80fd\u4e3a\u7a7a"},onkeyup:!0});$("#daily_trip_form").validate({rules:{"daily_trip[desc]":{required:!0}}});$(".house_home_search_form").validate({showErrors:function(b,a){return!0},rules:{name:{required:!0}},
invalidHandler:function(b){$(".house_suggester").show()}});(function(){function b(b){"chs"==b?$.ajax({data:{type:"chs",place:$("#spot_name").val(),city:$("#spot_city_id_chzn span").text()},url:"/spots/check_place_name",dataType:"json",type:"GET",success:a}):"eng"==b&&$.ajax({data:{type:"eng",place:$("#spot_english_name").val(),city:$("#spot_city_id_chzn span").text()},url:"/spots/check_place_name",dataType:"json",type:"GET",success:c})}function a(a,c,b){$("#spot_name").parent().find(".error").remove();
"ok"!=a.status&&$("#spot_name").parent().append("<label for='spot_name' class='error'>"+a.errors.taken+"</label>")}function c(a,c,b){$("#spot_english_name").parent().find(".error").remove();"ok"!=a.status&&$("#spot_english_name").parent().append("<label for='spot_english_name' class='error'>"+a.errors.taken+"</label>")}$("#spot_city_id").live("change",function(){""!=$("#spot_name").val()&&b("chs");""!=$("#spot_english_name").val()&&b("eng")});$("#new_spot_form #spot_name").live("blur",function(){"\u9009\u62e9\u4e00\u4e2a\u5730\u65b9..."!=
$("#spot_city_id_chzn span").text()&&b("chs")});$("#new_spot_form #spot_english_name").live("blur",function(){"\u9009\u62e9\u4e00\u4e2a\u5730\u65b9..."!=$("#spot_city_id_chzn span").text()&&b("eng")})})()});
var show_sight_modal=function(b){return $.ajax({url:b,dataType:"json",type:"GET",success:function(a,c,b){$(a.html).appendTo("body").modal({backdrop:!1})}})},navigate_sight_modal=function(b){var a=$(".sight-modal.in").attr("id").substring(12),c=$("#wf_sight_"+a),e=$(".sight-item"),d;e.each(function(a,g){$(g).attr("id")==c.attr("id")&&(d="left"==b?$(e[a-1]):$(e[a+1]))});if(0==d.length)return"left"==b?show_simple_alert("\u5df2\u7ecf\u662f\u7b2c\u4e00\u5f20\u4e86. ^_^"):show_simple_alert("\u5df2\u7ecf\u662f\u6700\u540e\u4e00\u5f20\u4e86. ^_^"),
!1;a=d.attr("id").substring(9);return 0<$("#sight_modal_"+a).length?($(".modal.in").modal("hide"),$("#sight_modal_"+a).modal("show"),!1):$.ajax({url:"/sights/"+a,dataType:"json",type:"GET",success:function(a,c,b){$(".modal.in").modal("hide");$(a.html).appendTo("body").modal({backdrop:!1})}})};
$(function(){var b=$(".waterflow");b.imagesLoaded(function(){b.masonry({itemSelector:".item",gutter:8})});$(".star_cmd").live("click",function(a){$.ajax({url:$(this).attr("data_url"),dataType:"json",type:"POST",success:function(c,b,d){$(a.currentTarget).replaceWith(c.html)}});return!1});$(".like_cmd").live("click",function(a){$.ajax({url:$(this).attr("data_url"),dataType:"json",type:"POST",success:function(c,b,d){$(a.target).replaceWith(c.html)}});return!1});$(".sight-modal .comment_cmd").live("click",
function(a){a=$(this).parents(".sight-modal");var c=a.find("#comment_content");a.find(".comments_list").css("min-height","300px");a.animate({scrollTop:c.offset().top},"fast");c.focus()});$(".sight-detail-page .comment_cmd").live("click",function(a){a=$(this).parents(".sight-detail-page");var c=a.find("#comment_content");a.find(".comments_list").css("min-height","300px");a.animate({scrollTop:c.offset().top},"fast");c.focus()});$(".sight_modal_cmd").live("click",function(a){a=$(this).attr("data-sight-id");
if(0<$("#sight_modal_"+a).length)return $("#sight_modal_"+a).modal("show"),!1;show_sight_modal($(this).attr("href"));return!1});$(".sight_modal_nav_left").live("click",function(a){navigate_sight_modal("left");return!1});$(".sight_modal_nav_right").live("click",function(a){navigate_sight_modal("right");return!1});$(".modal-close-cmd").live("click",function(a){$(".modal.in").modal("hide")});$(".sights_list").on("click",".close",function(a){$(this).parents(".ie_sight_block").remove()});$(".delete_sight_cmd").live("ajax:success",
function(a,c,b,d){$(".modal.in").modal("hide");if(0<$("#timeline_wrapper").length)return remove_waterflow_sight(c.deleted_id),!1;$("#wf_sight_"+c.deleted_id).remove();0<$(".waterflow").length&&$(".waterflow").masonry("reload")});$(".add_banner_cmd").live("ajax:success",function(a,c,b,d){"success"==c.status?show_simple_alert("\u6dfb\u52a0banner\u6210\u529f!"):show_simple_alert("\u6dfb\u52a0banner\u5931\u8d25, \u53ef\u80fd\u662f\u65e0\u6cd5\u5339\u914d\u56fd\u5bb6\u6216\u8005\u4e0d\u662f\u6a2a\u56fe")});
$("input.formPush.disabled").live("click",function(a){a.preventDefault();return!1});$(".modal.sight-modal.in").live("click",function(a){a.target==$(this)[0]&&a.currentTarget==$(this)[0]&&$(this).modal("hide")});$(".more_sight_cmd").bind("click",function(a){"undefined"==typeof currentPage&&(currentPage=2);url=$(this).attr("href");url=0>url.indexOf("?")?url+"?version=2&page="+currentPage:url+"&version=2&page="+currentPage;$.ajax({url:url,type:"GET",dataType:"json",success:function(a,b,d){if(0==a.data.length)return $(".more_sight_cmd").button("finish"),
$(".more_sight_cmd").attr("disabled","disabled"),!1;a=$(a.html);$(".waterflow").append(a).masonry("appended",a);$(".lazy img").lazyload({threshold:300,effect:"fadeIn"});currentPage++;$(".more_sight_cmd").button("reset")},beforeSend:function(a,b,d){$(".more_sight_cmd").button("loading")},error:function(){$(".more_sight_cmd").button("reset")}});return!1});$(".sight-modal").live("hidden",function(){$("body").removeClass("modal-open")}).live("shown",function(){$("body").addClass("modal-open")});yu_spot_autocomplete("#spots_ac",
"/spots/match",function(a,c){"Spot"==c.item.place_type?($("#sight_spot_id").val(c.item.id),$("#sight_city_id").val(c.item.city_id)):"City"==c.item.place_type&&($("#sight_spot_id").val(0),$("#sight_city_id").val(c.item.id))},function(a,c){$("#sight_spot_id").val(0);$("#sight_city_id").val(0);$("#spots_ac").val("")},function(a,c){$("#sight_spot_id").val(c);$("#sight_city_id").val(0);$("#spots_ac").val(a)})});
$(function(){$("#spot_photos_slider").lemmonSlider({slideToLast:!1,infinite:!1,next_page_cb:function(){$(".item.lazy").find("img").each(function(b,a){$(a).attr("src",$(a).data("original"))})}});$(".info_place").on("click",".more_cmd",function(){0<$(this).parent(".short").length?($(this).parents(".info-row").find(".info_place").hide(),$(this).parents(".info_place").addClass("active").show()):($(this).parents(".info-row").find(".info_place").show(),$(this).parents(".info_place").removeClass("active"))});
$(".map_spot_cmd").click(function(b){b=$(this).data("place-type");var a=$(this).data("place-id");window.map&&(b=window.map.find_marker_by_place(b,a),window.map.focus_marker(b),google.maps.event.trigger(b,"click"));return!1})});
$(function(){function b(c){$(c).parents(".message_cmd_block");var b=$(".message_modal"),d=$(b).find(".conversation"),f=$(d).find(".show_more");$(b).modal("show");$(b).find("textarea").focus();$.ajax({url:"/messages/latest_messages",dataType:"json",type:"GET",data:{nickname:$(c).data("nickname")},success:function(c,b,e){$(d).html($(c.html));$(f).show();a(d,0)}});var g=$(b).find(".info_field");$.ajax({url:"/messages/related_orders",dataType:"json",type:"GET",data:{nickname:$(c).data("nickname")},success:function(a,
c,b){$(g).html($(a.html))}});return!1}function a(a,b){$(a).animate({scrollTop:$(a)[0].scrollHeight},b)}$(".new_message_cmd").on("click",function(a){$(".message-modal").find("#message_nickname").val("");a=$("#conversation_user_nickname").text();""!=a&&$(".message-modal").find("#message_nickname").val(a);$(".message-modal").modal("show");return!1});$("#message_nickname").autocomplete({source:"/users/match",minLength:1,delay:300,autoFocus:!0});$(".reply_message_cmd").live("click",function(a){var e=$(this);
$.ajax({url:"/messages/modal",dataType:"json",type:"GET",data:{nickname:$(this).data("nickname"),order_id:$(this).data("order_id")},success:function(a,c,g){$(".message_modal").remove();$(a.html).appendTo($(document.body));b(e)}});return!1});$(".message_form").live("ajax:success",function(c,b,d){c=$(this).find(".conversation");d=$(this).parents(".message_modal");$(d).find("textarea").val("");"success"==b.status?($(b.html).appendTo($(c)),$(".no_message").hide(),a(c,500)):show_simple_alert(b.msg)});
$(".message_form .show_more").live("click",function(){var c=$(this).parents(".conversation");$(this);$.ajax({url:"/messages/more_messages",dataType:"json",type:"GET",data:{nickname:$(this).parents(".message_form").data("nickname")},success:function(b,d,f){$(c).html($(b.html));a(c,0)}})});$(".message_form").live("keydown","textarea",function(a){13==a.which&&(a.preventDefault(),$(this).submit())})});
$(function(){$(".add-special-cmd").live("click",function(b){$(this).parents(".sight-modal").find(".special-modal").show()});$(".add-special-form").live("ajax:success",function(){$(this).parents(".special-modal").removeClass("in").hide();show_simple_alert("\u6dfb\u52a0\u4e13\u9898\u6210\u529f")}).live("ajax:error",function(){show_simple_alert("\u6dfb\u52a0\u4e13\u9898\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\u6216\u8005\u9009\u62e9\u5176\u4ed6\u4e13\u9898/\u89c1\u95fb")});$(".delete-special-sight-cmd").bind("ajax:success",
function(b,a,c,e){$("#sight_"+a.deleted_id).remove()});$(".special-modal .close").live("click",function(b){$(this).parents(".special-modal").hide();return!1})});
$(function(){function b(a){a=$(a).parents(".comment_wrapper").parent(".comment_item");var c=$(a).find(".reply_list");$(c).next("#new_reply").appendTo(".hidden_area");$(c).remove();$(a).remove()}$("#new_comment").live("ajax:success",function(a,c,b){"success"==c.status?(a=$(this).siblings(".comments_list"),b=$(this).find("#comment_content"),$(c.html).prependTo(a).hide().slideDown(300),$(b).val(""),$("p.empty_list").remove()):show_simple_alert(c.msg)});$("#new_reply").live("ajax:success",function(a,
c,b){"success"==c.status?(a=$(this).find(".reply_text"),$(a).val(""),$(c.html).appendTo($(this).prev(".reply_list")).hide().slideDown(300),$("#new_reply").hide()):show_simple_alert(c.msg)});$(".comment_item .comment_wrapper").live("hover",function(a){$(this).find(".cmd").toggle()});$(".comment_item .transfer_comment_cmd").live("ajax:success",function(a,c,e,d){b(this)});$(".comment_item .delete_comment_cmd").live("ajax:success",function(a,c,e,d){b(this)});$(".comment_item .reply_comment_cmd").live("click",
function(){var a=$(this).parents(".comment_item.parent").attr("id").split("_")[1],c=$(this).parents(".comment_item.parent").find(".reply_list"),b=$(this).parents(".comment_item"),d=$("#new_reply");$(d).insertAfter(c);$(d).show();$(d).find("#comment_parent_id").val(a);a=" \u56de\u590d@"+$(b).find(".name").html()+" : ";$(d).find(".reply_text").val(a).focus().setCursorPosition(a.length)});$(".comment_btn_container .cancel_button").live("click",function(){$("#comment_content").val("");$("#new_comment").data("validator").resetForm();
return!1});$(".reply_btn_container .cancel_button").live("click",function(){$("#reply_content").val("");$("#new_reply").hide();$("#new_reply").data("validator").resetForm();return!1})});
$(function(){$("#user_password").bind("keyup",function(b){var a=$("#user_password").val();b=0;b=6>a.length?0:9>a.length?null!=a.match(/^[a-zA-Z]+$/)?0:null!=a.match(/^[a-zA-Z0-9]+$/)?1:7>=a.length?1:2:null!=a.match(/^[a-zA-Z]+$/)?1:2;var a="",c="0%";0==b?(a="progress-danger",c="33%"):1==b?(a="progress-info",c="66%"):(a="progress-success",c="100%");$(".pwd_intension").removeClass("progress-danger");$(".pwd_intension").removeClass("progress-info");$(".pwd_intension").removeClass("progress-success");
$(".pwd_intension").addClass(a);$(".pwd_intension").html("<div class='bar' style='width:"+c+"'></div>")});$("#invite_tabs a:first").tab("show");$(".resume_admin_cmd").live("ajax:success",function(b,a,c,e){"success"==a.status?$(a.html).appendTo("body").modal("show"):show_simple_alert("\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")});$(".js_resume_admin").live("click",function(b){$("#js_resume_admin_form").submit()});$(".js-delete-user-contact").live("ajax:success",function(b,a,c,e){"success"==
a.status&&$(this).parents(".js-user-contact").remove()})});
$(function(){$(".correct_info_cmd").bind("ajax:success",function(b,a,c,e){"success"==a.status?($(a.html).appendTo("body").modal("show"),$("#new_info_history.correct-info-form").validate({rules:{"info_history[name]":{required:!0,rangelength:[2,10]},"info_history[content]":{required:!0}},onkeyup:!1})):show_simple_alert("\u64cd\u4f5c\u5931\u8d25\uff01\u662f\u5426\u672a\u767b\u5f55\uff1f")});$(".correct-info-form").live("ajax:success",function(b,a,c,e){"success"==a.status?(show_simple_alert("\u5df2\u63d0\u4ea4\u540e\u53f0\u5ba1\u6838\uff01\u591a\u8c22\u60a8\u7684\u8d21\u732e\uff01"),
$(".modal.in").modal("hide")):show_simple_alert("\u63d0\u4ea4\u5931\u8d25\uff01\u8bf7\u91cd\u8bd5\u6216\u53d6\u6d88\uff01")})});
$(function(){$("#new_spot_form").live("ajax:success",function(b,a,c,e){"success"==a.status?(b=a.id,a=a.data.display_name,c=$(this).find("input[name='ac_field']").val(),$(c).data("new_spot_callback")(a,b,c),$(".modal.in").modal("hide").remove()):show_simple_alert(a.msg)});$(".view_spot_card_cmd").hover(function(){$(this).addClass("ready")},function(){$(this).removeClass("ready")});$(".view_spot_card_cmd").hover(function(b){b=$(this);$.ajax({url:b.data("card"),dataType:"json",type:"GET",success:function(a,
c,e){"success"==a.status&&b.popover({html:!0,content:a.html,trigger:"manual",template:'<div class="spot-popover popover" onmouseover="clearTimeout(timeoutObj);$(this).mouseleave(function(){$(this).hide();});"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div>'}).popover("show")}})},function(b){var a=$(this);0>=a.next(".popover.in").length||(timeoutObj=setTimeout(function(){a.popover("hide")},300))});$(".resize_map_cmd").live("click",function(b){b=
$(this);var a=b.data("map-state"),c=window.map;if(!c)return!1;"little"==a?(b.data("map-state","big"),b.parents(".modal-body").find(".left-column").hide(),b.parents(".right-column").width("auto"),c.resize_with_canvas("map_canvas",600,330)):(b.data("map-state","little"),b.parents(".modal-body").find(".left-column").show(),b.parents(".right-column").width(260),c.resize_with_canvas("map_canvas",260,330));c.setCenter(c.get_markers()[0].getPosition());return!1});$("#spot_name, #spot_english_name, #spot_location").blur(function(b){b=
$("#spot_location").val();var a=$("#spot_name").val(),c=$("#spot_english_name").val();pri_loc=0<b.length?b:0<c.length?c:a;(b=window.map)&&googlemap_code_address(b,pri_loc,function(a,c){$("#spot_latitude").val(c.lat());$("#spot_longitude").val(c.lng());$("#spot_gmaps").val(a.getZoom())})})});
var resource_calendar_ajax=function(b,a){$.ajax({url:b,dataType:"json",type:"GET",success:function(c,b,d){$(a).html(c.html)}})},resource_calendar_with_price=function(b,a){var c="#"+b,e,d,f;$("table.calendar thead tr:first-child th:first-child",c).live("click",function(b){e=$("table",c).attr("id");d=$(c).data("source-id");version=$(c).data("version");f="/"+a+"/"+d+"/calendar?direct=previous&month="+e+"&version="+version;resource_calendar_ajax(f,c)});$("table.calendar thead tr:first-child th:last-child",
c).live("click",function(b){e=$("table",c).attr("id");d=$(c).data("source-id");version=$(c).data("version");f="/"+a+"/"+d+"/calendar?direct=next&month="+e+"&version="+version;resource_calendar_ajax(f,c)})};
$(function(){$(".posters_list").delegate(".close","click",function(b){$(this).parents(".poster").remove();return!1});(function(){var b=function(a){$(".filter",a).on("click","input:checkbox",function(c){c=$(this).parents(".filter").find("input:checkbox");$.each(c,function(a,c){$(c).prop("checked",!1)});$(this).prop("checked",!0);url=window.location.href.split("?")[0];window.location.href=url+"?"+$("input:checkbox",a).serialize()})};0<$(".aside_filter").length&&b(".aside_filter")})();$(".sub_resource_banner").hover(function(){1<
$(this).find(".item").length&&$(this).find(".carousel-control").show()},function(){$(this).find(".carousel-control").hide()});$(".subresource_price_calendar ").each(function(){resource_calendar_with_price($(this).attr("id"),$(this).data("source-type"))});$(".check_price_cal_cmd").bind("click",function(){$(this).parents(".subresource").find(".price_tab").tab("show")});$(".resource_pay_style_radio").change(function(b){b=$(this).val();var a=$("textarea[name*='drawback_contract']");"0"==b?a.val(a.data("full")):
a.val(a.data("deposit"))});$(".resource_drawback_policy_radio").change(function(b){b=$(this).data("policy_name");var a=$(".drawback_policy_content");a.val(a.data(b))});$("input:radio",".profit").click(function(){var b=$(this).attr("class");$("span",".profit").hide();$("span",".append_price").hide();$("span."+b).show();"discount"==b?$(".discount",".relate_price").show():$(".discount",".relate_price").hide()});"discount"==$("input:radio:checked",".profit").attr("class")&&$(".discount",".relate_price").show()});
(function(){$("a",".resource_search").click(function(){klass=$(this).attr("class").split(" ")[0];$("#"+klass,".resource_search").val($(this).data("val"));"city_id"==klass&&$("#spot_id").val("");$(".resource_search").submit()})})();
var remove_tour_project_special_price=function(b){$(b).prev("input[type=hidden]").val("1");$(b).closest(".additional-group").addClass("hide").hide()},tour_project_price_datepicker_opts={first_picker_class:"start_datepicker",second_picker_class:"end_datepicker",disable_past:!1},add_tour_project_special_price=function(b,a,c){b=(new Date).getTime();a=new RegExp("new_"+a,"g");$(".tour_project_special_prices_list").append(c.replace(a,b));$(".tour_project_special_prices_list .special_price").datepicker_pairs(tour_project_price_datepicker_opts);
c=$(".js_form_data");$(".js_cost_price").price_indicator({fish_ratio:c.data("fish-ratio"),fish_fee:c.data("fish-fee")});c=$(".js_form_data");$(".price-input-pairs").price_indicator_pairs({fish_ratio:c.data("fish-ratio"),fish_fee:c.data("fish-fee")})},remove_additional_schedule=function(b){$(b).prev("input[type=hidden]").val("1");$(b).closest(".additional-group").addClass("hide").hide();$("ul.tour-schedules-list > li:visible").each(function(a,c){$(c).find("span.num").html(a+1)})},add_additional_schedule=
function(b,a,c){b=$(".tour_schedules_list .tour_schedule").last().find(".schedule_day").val();$(".tour_schedules_list .tour_schedule").last().find(".schedule_time").val();var e=(new Date).getTime();a=new RegExp("new_"+a,"g");$(".tour_schedules_list").append(c.replace(a,e));c=$("ul.tour-schedules-list > li:visible").length;$(".tour-schedules-list .tour-schedule:last-child span.num").html(c);c=$(".tour_schedules_list .tour_schedule").last();c.find(".schedule_day").val(parseInt(b));b=$(".schedule_type_buttons input[type=radio]:checked");
c.find(".schedule_daytime").addClass(b.attr("class"))};
$(function(){$(".tour_spots_autocomplete:not(.ui-autocomplete-input)").live("focus",function(a){var c="#"+$(this).attr("id");yu_spot_autocomplete(c,"/spots/match?type=spot&enable_add=true&",function(a,b){"Spot"==b.item.place_type&&$(c).next("input[type=hidden]").val(b.item.id)},function(a,b){$(c).next("input[type=hidden]").val(0);$(c).val("")},function(a,b){$(c).next("input[type=hidden]").val(b);$(c).val(a)})});$("#tour_slogan").inputLimit(140);$(".tour_project_tabs").sortable();$(".btn_buy.disable").bind("click",
function(a){return!1});$(".tour_project_special_prices_list .special_price").datepicker_pairs(tour_project_price_datepicker_opts);$(".recommend_tour_radio").bind("click",function(a){$("#tour_people_limit").val("0");$("#tour_cost").val("0")});$(".tour_schedules_list").sortable({items:"> li",update:function(a,c){var b=$("ul.tour_schedules_list > li:visible"),d=b.length;for(i=0;i<d;i++){var f=b[i];$(f).find("span.num").html(i+1);$(f).find(".position").val(i+1)}}});(function(){var a=function(a,b){$.ajax({url:a,
dataType:"json",type:"GET",success:function(a,c,g){$(b).html(a.html)}})};(function(c){var b="#"+c;c=$(b).data("source-id");var d=$(b).data("version"),f="/activities/"+c+"/effective_calendar?&version="+d;$("table.calendar thead tr:first-child th:first-child",b).live("click",function(c){c=$("table",b).attr("id");a(f+"&direct=previous&month="+c,b)});$("table.calendar thead tr:first-child th:last-child",b).live("click",function(c){c=$("table",b).attr("id");a(f+"&direct=next&month="+c,b)})})("tour_effective_calendar")})();
(function(){yu_spot_autocomplete("#tour_spots","/spots/match?type=spot",function(c,b){0<b.item.id&&($("#tour_spots_desc").append("<label class='tour-spot'>%NAME%<span class='close'>&times;</span><input name='tour[tour_schedules_attributes][%TIME%][spot_id]' value='%VALUE%' type='hidden' /><input name='tour[tour_schedules_attributes][%TIME%][position]' type='hidden' class='position'><input name='tour[tour_schedules_attributes][%TIME%][_destroy]' type='hidden' value='false' class='destroy'></label>".replace(/%NAME%/,
b.item.value.split(",")[0]).replace(/%VALUE%/,b.item.id).replace(/%TIME%/g,Date.now())),a());"new_spot"!==b.item.place_type&&($("#tour_spots").val(""),c.preventDefault())},function(a,b){$("#tour_spots").val("")},function(c,b){$("#tour_spots_desc").append("<label class='tour-spot'>%NAME%<span class='close'>&times;</span><input name='tour[tour_schedules_attributes][%TIME%][spot_id]' value='%VALUE%' type='hidden' /><input name='tour[tour_schedules_attributes][%TIME%][position]' type='hidden' class='position'><input name='tour[tour_schedules_attributes][%TIME%][_destroy]' type='hidden' value='false' class='destroy'></label>".replace(/%NAME%/,
c.split(",")[0]).replace(/%VALUE%/,b).replace(/%TIME%/g,Date.now()));$("#tour_spots").val("");a()});$("#tour_spots_desc").sortable({stop:function(){a()}});var a=function(){$("#tour_spots_desc").find(".position").each(function(a){$(this).val(a+1)})};$("span.close","#tour_spots_desc").live("click",function(){$(this).parent().hide();$(this).parent().find("input.destroy").val("1")})})();(function(){$(".tour_project_wrapper").on("ajax:success",".switch_project_cmd",function(a,b,e,d){"success"==b.status&&
$(".tour_project_wrapper").html(b.html)});$(".tour_project_wrapper").on("click",".detail_price_cmd",function(){$(".detail_price_cmd[rel=popover]").popover({html:!0,trigger:"click",placement:"left",content:function(){return $(this).next(".price_cal_popover_wrapper").html()}}).popover("show");$(".subresource_price_calendar ").each(function(){resource_calendar_with_price($(this).attr("id"),$(this).data("source-type"))});$("body").click(function(a){$(a.target).parents(".popover").size()||$(a.target).parents(".price").size()||
$(".popover.in").each(function(a,b){"block"==$(b).css("display")&&$(b).prev(".detail_price_cmd").popover("hide")})})})})();(function(){$(".tour_buy_cmd").bind("click",function(){var a=$(this),b=a.parents(".tour_projects_list"),e=b.find(".tour_project_id");if(""==e.val())return b.find(".names").addClass("warn"),!1;b=a.attr("href")+"&rid="+e.val();a.attr("href",b)});$(".switch_project_cmd").bind("click",function(){var a=$(this),b=a.parents(".tour_projects_list");b.find(".tour_project_id").val(a.data("id"));
b.find(".name > a").removeClass("active");a.addClass("active");b.find(".price").html(a.data("price"));b.find(".desc").html(a.data("desc"));b.find(".names").removeClass("warn")})})();$(".tour_content .tab_wrapper").yu_flow_nav();$("body").scrollspy({target:".tab_wrapper"});$(".tour_content .nav.yu_tabs li").on("click",function(){$(this).siblings(".active").removeClass("active");$(this).addClass("active")});$(".js_booking_limit").on("focus",function(){tour_last_value=$(this).val()}).change(function(a){a=
$(this).val();var b=$(".booking_at_least").val(),e=$(".booking_at_most").val();parseInt(e)<parseInt(b)&&(alert("\u81f3\u591a\u9884\u5b9a\u5929\u6570\u4e0d\u80fd\u5c0f\u4e8e\u81f3\u5c11\u9884\u5b9a\u5929\u6570"),$(this).val(tour_last_value),a=tour_last_value);b=a;a=new Date;b=a.getTime()+864E5*b;a.setTime(b);a=a.format("yyyy-MM-dd");$(this).parent().find(".service_date").html(a)});var b=function(){$(".js_day_ids").prop("disabled",$(".js_tour_daily").prop("checked"))};$(".js_tour_daily").one(b()).change(b)});
$(function(){$("#people_min").textQuickChange({theme:"inbox"});$("#people_max").textQuickChange({theme:"inbox"})});
var remove_room_special_price=function(b){$(b).prev("input[type=hidden]").val("1");$(b).closest(".additional-group").addClass("hide").hide()},room_price_datepicker_opts={first_picker_class:"start_datepicker",second_picker_class:"end_datepicker",disable_past:!1},add_room_special_price=function(b,a,c){b=(new Date).getTime();a=new RegExp("new_"+a,"g");$(".room_special_prices_list").append(c.replace(a,b));"discount"==$("input:radio:checked",".profit").attr("class")&&$("div.discount",".special_price").show();
$(".room_special_prices_list .special_price").datepicker_pairs(room_price_datepicker_opts);c=$(".js_form_data");$(".js_cost_price").price_indicator({fish_ratio:c.data("fish-ratio"),fish_fee:c.data("fish-fee")});c=$(".js_form_data");$(".price-input-pairs").price_indicator_pairs({fish_ratio:c.data("fish-ratio"),fish_fee:c.data("fish-fee")})},add_room_special_price_template=function(b,a,c){$(".room_special_prices_list").append(c);"discount"==$("input:radio:checked",".profit").attr("class")&&$("div.discount",
".special_price").show();$(".room_special_prices_list .special_price").datepicker_pairs(room_price_datepicker_opts);b=$(".js_form_data");$(".js_cost_price").price_indicator({fish_ratio:b.data("fish-ratio"),fish_fee:b.data("fish-fee")});b=$(".js_form_data");$(".price-input-pairs").price_indicator_pairs({fish_ratio:b.data("fish-ratio"),fish_fee:b.data("fish-fee")})};
$(function(){$("#house_slogan").inputLimit(140);$(".room_tabs").sortable();$("a.map_tab_cmd").on("shown",function(b){b=window.map;var a=b.getCenter();b.resize_with_canvas("house_map_canvas",620,360);b.setCenter(a)});$(".static_map_cmd").bind("click",function(){$(".map_tab_cmd").tab("show")});$(".house_map_locator_cmd").click(function(b){b=$("#house_location").val();pri_loc=0<b.length?b:"";(b=window.map)&&googlemap_code_address(b,pri_loc,function(a,b){$("#house_latitude").val(b.lat());$("#house_longitude").val(b.lng());
$("#house_gmaps").val(a.getZoom())})});$(".edit_special_prices_list").sortable({stop:function(){$(".edit_special_prices_list").find("li").each(function(b){$(".position",this).val(b+1)})}});$(".map_locator_cmd").click(function(b){b=$("#house_location").val();pri_loc=0<b.length?b:"";window.map&&googlemap_code_address(window.map,pri_loc,function(a,b){$("#house_latitude").val(b.lat());$("#house_longitude").val(b.lng());$("#house_gmaps").val(a.getZoom())})});$(".new_house_order_block").affix({offset:{top:600,
bottom:function(){return $(".house-map").outerHeight(!0)+$(".recommend-resource").outerHeight(!0)+$("pre_footer").outerHeight(!0)+$(".footer").outerHeight(!0)+380}}})});$(function(){});
(function(){$(".room_check_price").popover({html:!0,trigger:"click",placement:"left",content:function(){return $(this).next().html()}});$("body").click(function(a){0<$(a.target).parents(".popover").size()||0<$(a.target).parents(".calendar").size()||$(".popover.in").each(function(a,b){"block"==$(b).css("display")&&$(".room_check_price").popover("hide")})});$(".area_select",".house_search").change(function(){$(".city",".map").css("background-position","0 "+$("option:selected",$(this)).data("position"));
var a=$(this).find("option:selected").text(),b=$(".house_suggester .item"),c=null;$.each(b,function(b,d){$(d).data("city-name")==a&&(c=$(d))});null!=c?(b.hide(),c.show()):b.show()});$(".house_home_search .date_picker_wrapper").datepicker_pairs({first_picker_class:"house_home_search_checkin_day",second_picker_class:"house_home_search_checkout_day",second_picker_is_behind_a_day:!0});$(".js_houses_index_query").on("click",function(a){b()});$(".js_houses_index_landmarks span").on("click",function(a){a=
$(this).text().trim();$(".house_filter_name").val(a);$(".js_houses_index_landmarks span").removeClass("active");$(this).addClass("active");b()});$(".js_houses_index_cost_index span").on("click",function(a){a=$(this).data("cost-index");$(".house_filter_cost_index").val(a);$(".js_houses_index_cost_index span").removeClass("active");$(this).addClass("active");b()});$(".js_houses_index_confirm_response span").on("click",function(a){a=$(this).data("confirm-response");$(".house_filter_confirm_response").val(a);
$(".js_houses_index_confirm_response span").removeClass("active");$(this).addClass("active");b()});var b=function(){$(".js_house_show_loading").show();a()},a=function(){$form=$(".js_house_index_query_form form");if($form.hasClass("disabled"))return!1;$.ajax({url:$(this).attr("action"),data:$form.serialize(),dataType:"json",type:"GET",context:this,beforeSend:function(){$form.addClass("disabled");$(".js_houses_index_query").attr("disabled","disabled")},complete:function(){$form.removeClass("disabled");
$(".js_house_show_loading").hide();$(".js_houses_index_query").removeAttr("disabled")},success:function(a){"success"==a.status&&$(".js_house_index_houses_list").replaceWith(a.html)}})};$(".house_home_search .yicon-house-home-search-calendar.checkin").click(function(a){$(".house_home_search .date_picker_wrapper input.house_home_search_checkin_day").focus()});$(".house_home_search .yicon-house-home-search-calendar.checkout").click(function(a){$(".house_home_search .date_picker_wrapper input.house_home_search_checkout_day").focus()});
$("body").click(function(a){0!=$(".house_suggester").size&&0!=$(".house_home_search_name").size&&(0<$(a.target).parents(".house_suggester").size()||$(a.target).hasClass("house_suggester")||0<$(a.target).parents(".house_home_search_name").size()||$(a.target).is(".house_home_search_name")||$(a.target).is(".yicon-house-home-search-place")||$(".house_suggester").hide())});$(".house_home_search_name",".house_home_search").click(function(){$(".house_suggester").toggle()});$(".yicon-house-home-search-place",
".house_home_search").click(function(){$(".house_suggester").toggle()});$("a",".house_suggester").click(function(){0==$(this).data("ignore_flag")&&($(".house_home_search_name",".house_home_search").val($(this).text()),$(".house_suggester").toggle())});$(".house_list_filter .house_filter_city_id").on("change",function(a){});$(".house_search.house_list_filter").datepicker_pairs({first_picker_class:"checkin_date_picker",second_picker_class:"checkout_date_picker",second_picker_is_behind_a_day:!0});var c=
"\u65e5\u4e00\u4e8c\u4e09\u56db\u4e94\u516d".split("");$(".house_search.house_list_filter .checkin_date_picker").datepicker().on("changeDate",function(a){a="\uff08\u661f\u671f"+c[a.date.getDay()]+"\uff09";$(".weekday.checkin_weekday").text(a)});$(".house_search.house_list_filter .checkout_date_picker").datepicker().on("changeDate",function(a){a="\uff08\u661f\u671f"+c[a.date.getDay()]+"\uff09";$(".weekday.checkout_weekday").text(a)});$(".house_search.house_list_filter .weekday.checkin_weekday").click(function(a){$(".house_search.house_list_filter .checkin_date_picker input").focus()});
$(".house_search.house_list_filter .weekday.checkout_weekday").click(function(a){$(".house_search.house_list_filter .checkout_date_picker input").focus()});$(".room_special_prices_list .special_price").datepicker_pairs(room_price_datepicker_opts);$(".house_show_page .tab_wrapper").yu_flow_nav({fix_width:!1});$("body").scrollspy({target:".tab_wrapper"});$(".house_show_page .nav.yu_tabs li").on("click",function(){$(this).siblings(".active").removeClass("active");$(this).addClass("active")})})();
var remove_additional_attendence=function(b){$(b).prev("input[type=hidden]").val("1");b=$(b).closest(".attendence");$(b).addClass("hide").hide();$(b).prev(".common_attendences").addClass("hide").hide()},add_additional_attendence=function(b,a,c){b=(new Date).getTime();a=new RegExp("new_"+a,"g");$(".attendences_list").append(c.replace(a,b));return!1};
$(function(){$(".view_order_cmd").live("ajax:success",function(a,b,e,d){"success"==b.status?$(b.html).appendTo("body").modal("show"):show_simple_alert("\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")});$(".view_my_order_detail_cmd").live("ajax:success",function(a,b,e,d){"success"==b.status?$(b.html).appendTo("body").modal("show"):show_simple_alert("\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")});$(".js_orders_my_urge_retailer_cmd").live("click",function(a){_this_ele=$(this);$.ajax({url:$(this).data("url"),
dataType:"json",type:"GET",success:function(a,b,d){"success"==a.status&&_this_ele.replaceWith(a.replace_text)}})});$(".ticket_tip_cmd").on({hover:function(){$(this).tooltip("show")}});(function(){var a=function(a){var b=$(a).parents("form");a=b.data("unit-price-path");b=b.serialize();$.ajax({url:a,dataType:"json",type:"POST",data:b,success:function(a,b,c){"success"==a.status&&($(".pay_info").replaceWith(a.html),$("#total_days").html(a.data.total_days))}})};$("#house_order_number").on("numChange",
function(){var a=parseInt($(this).val()),b=$(this).data("max-num"),d=+$("#house_order_append_number").data("max-num-per-room");0<b&&a>b?$(this).nextAll(".alert").show():($(this).nextAll(".alert").hide(),a*=d,$("#house_order_append_number").data("max-num",a),$("#house_order_append_number").change(),$(".add_bed_num").html(a))});$(".new_order_resource").on("blur",".backup_train",function(){a(this)});$(".new_order_resource").on("change",":input",function(b){a(this);b=$(this).data("target");var e=$(this).children("option:selected").data("seat");
$(b).text(e)})})();$(".order_change_price_cmd").bind("click",function(a){$(this).parents(".order.unprocess").find(".price_edit_group").show()});$(".pay_now_btn").bind("click",function(a){$(".prepay-modal").modal("show");return!0});$(".js-new-order-form").on("click",".js-common-contacts .jccontacts__btn",function(a){a=$(this).parents(".js-common-contacts-wrapper");var b=$(this).data("real-name"),e=$(this).data("cellphone"),d=$(this).data("email"),f=$(this).data("wechat"),g=$(this).data("qq");a.find(".real_name").val(b);
a.find(".cellphone").val(e);a.find(".email").val(d);a.find(".wechat").val(f);a.find(".qq").val(g)});$(".order_contracts").on("click",".tos_cmd, .drawback_cmd, .indemnity_cmd",function(){$(this).popover("toggle")});(function(){$(".date[rel=popover]").popover({html:!0,trigger:"click",placement:"bottom",content:function(){return $(this).next(".price_cal_popover_wrapper").html()}});$(".container").click(function(a){$(a.target).parents(".popover").size()||$(a.target).parents(".date").size()||$(".popover.in").each(function(a,
b){"block"==$(b).css("display")&&$(b).prev(".date").popover("hide")})});$(".new_order_resource").on("click",".popover table.calendar tr td",function(){if($(this).hasClass("disable"))return!1;var a=$(this).parents(".popover-content").find(".subresource_price_calendar").html();$(this).parents(".popover").next(".price_cal_popover_wrapper").find(".subresource_price_calendar").html(a);$(this).parents(".popover").prev(".date").find("input").val($(this).data("day")).change();$(this).parents(".popover").prev(".date").popover("hide")});
$(".new_order_resource .start_day_block ").on("click",".popover table.calendar tr td",function(){if($(this).hasClass("disable"))return!1;var a=$(".end_day_block").find(".date input"),b=$(this).data("day");b>a.val()&&(b=new Date(b),b=new Date(b.getFullYear(),b.getMonth(),b.getDate()+1),$(a).val($.datepicker.formatDate("yy-mm-dd",b)));a=$(this).parents(".popover-content").find(".subresource_price_calendar").html();$(".end_day_block").find(".price_cal_popover_wrapper").find(".subresource_price_calendar").html(a);
$(this).parents(".new_order_resource").find(".end_day_block .date").popover("show")});$(".new_order_resource").on("click",".date",function(){var a=$(this);$(".new_order_resource").find(".date").each(function(b,e){a.get(0)!==e&&$(e).popover("hide")})})})();var b=function(a){var b="/orders/"+$(a).data("oid")+"/detail",e=$(a).parents(".my_orders").find(".detail_wrapper");$.ajax({url:b,dataType:"json",type:"GET",success:function(b,c,g){$(e).html(b.html);$(".my-order-list .order.active").removeClass("active");
$(".my_orders_init_right").hide();$(a).addClass("active");b=$(".detail_field .fixed_block");$(b).css("max-height",$(window).height()-50);$(b).height()>$(".my_orders").height()-99?$(b).addClass("no-affix"):$(b).removeClass("no-affix")}})};$(".my_order_list").on("click","li.order",function(){($(".order_detail").is(":hidden")||$(".order_detail").data("oid")!=$(this).data("oid"))&&b(this)});(function(){$(".start_day_picker").datepicker_with_text({format:"yyyy-mm-dd",weekStart:1,language:"zh-CN"});$(".my_calendar_block").on("click",
".order_cal_more_cmd",function(){$(this).parents(".day").find(".day_orders_detail").addClass("open").show()});$(".my_calendar_block").on("click","table.my_orders_calendar",function(a){$(a.target).hasClass("order_cal_more_cmd")||$(a.target).parents(".day_orders_detail.open").size()||$(".day_orders_detail.open").size()&&$(".day_orders_detail").removeClass("open").hide()});$(".my_calendar_block").on("click","table.my_orders_calendar thead tr:first-child th:first-child",function(a){a=$(this).parents("table").attr("id");
self.location="/orders/calendar?direct=previous&month="+a});$(".my_calendar_block").on("click","table.my_orders_calendar thead tr:first-child th:last-child",function(a){a=$(this).parents("table").attr("id");self.location="/orders/calendar?direct=next&month="+a})})();(function(){if("1"==$(".attendences_list").data("attendence-mode"))var a=function(){for(var a=$(".attendences_list .attendence:visible").length,b=parseInt($(".attendence_number").val()),d=0;d<Math.abs(b-a);d++)if(b>a){var f=add_attendence_content;
add_additional_attendence($(".add_attendence_cmd"),"attendence",f)}else remove_additional_attendence(".attendences_list .attendence:visible .close:last")};$(".attendence_number").on("numChange",a);$(".attendence_number").change()})();(function(){$(".js_specific_order_children_number_input").on("blur",function(a){var b=parseInt($(".js_specific_order_children_number_input").val()),e=$(this).data("append-target"),d=$(".js_specific_order_children_age_group").size();for(0==b?$(".js_specific_order_children_age_group").remove():
d>b&&$(".js_specific_order_children_age_group:gt("+(b-1)+")").remove();d<b;d++){var f=0==d?"\u513f\u7ae5\u5e74\u9f84":"",g="\u7b2c"+(d+1)+"\u4f4d",h=$(".js_specific_order_children_number_group").data("specific-name"),f="<div class='control-group js_specific_order_children_age_group'><label class='control-label'>"+f+"</label><div class='controls'><input class='span2 js_specific_order_children_age_input' type='text' placeholder='\u8bf7\u8f93\u5165\u513f\u7ae5\u7684\u5e74\u9f84' name='"+h+"[children_ages][]'><span class='tail'>"+
g+"</span></div></div>";$(e).parent().append(f)}a&&a.stopPropagation?a.stopPropagation():window.event.cancelBubble=!0});$(".js_specific_order_children_age_input").live("change",function(a){a&&a.stopPropagation?a.stopPropagation():window.event.cancelBubble=!0})})();(function(){$(".order").on("click",".radio_pair_btn",function(a){$(a.currentTarget).nextAll(".radio_pair_text").focus()});$(".order").on("focus",".radio_pair_text",function(a){$(a.currentTarget).prevAll(".radio_pair_btn").attr("checked",
!0)})})();$(".js_my_rates_nav").affix({offset:{top:100}});$(".my_orders .date_index").on("click","li",function(){$(this).parents(".date_index").find(".active").removeClass("active");$(this).addClass("active")});$(".my_orders .date_index").affix({offset:{top:200,bottom:452}});$(".my_orders .fixed_block").affix({offset:{top:200,bottom:452}});$(".my_orders .order .click_to_input_coupon_code").live("click",function(){$(this).parents(".order").find(".coupon_input").toggle()});$(".coupon_input_form").live("ajax:success",
function(a,c,e,d){b($(this).parents("li.order"))});$("body").scrollspy({target:".my_orders .index_field"});$("body .container").on("click",function(a){0==$(a.target).closest(".fixed_block, .modal, .my_order_list li.order, .modal-backdrop, header, .index_field").length&&($(".order_detail").hide(),$(".my_orders_init_right").show(),$(".my-order-list .order.active").removeClass("active"))});$(window).on("scroll",function(){$(".my_order_list .date").each(function(){var a=$(this).offset().top;a>=$(window).scrollTop()-
40&&a<$(window).scrollTop()+40&&($(".date_index .active").removeClass("active"),$(".date_index_"+$(this).attr("id")).addClass("active"))})});$(".js_orders_my_drawback_policy").on("click",function(){if($(this).hasClass("disabled"))return!1;$.ajax({url:$(this).data("url"),type:"get",dataType:"json",context:this,beforeSend:function(){$(this).addClass("disabled")},success:function(a){if("success"==a.status){var b=$(".js_orders_my_drawback_policy_modal");b.html(a.html);b.modal("show")}},complete:function(){$(this).removeClass("disabled")}})});
$(".js_orders_my_drawback_order_detail").on("click",function(){if($(this).hasClass("disabled"))return!1;$.ajax({url:$(this).data("url"),type:"get",dataType:"json",context:this,beforeSend:function(){$(".js_orders_my_drawback_order_detail").addClass("disabled")},success:function(a){"success"==a.status&&($(".js_orders_my_drawback_order_detail_content").html(a.html),$(".js_orders_my_drawback_order_detail_modal").modal("show"))},complete:function(){$(".js_orders_my_drawback_order_detail").removeClass("disabled")}})})});
$(function(){var b=function(a){var c=$(a).parents("form");a=c.data("refresh-path");c=c.serialize();$.ajax({url:a,dataType:"json",type:"GET",data:c,success:function(a,c,f){"success"==a.status&&($(".new_house_order_block").html(a.html),$(".new_house_order_block").datepicker_pairs({first_picker_class:"checkin_date_picker",second_picker_class:"checkout_date_picker",callback:b}))}})};$(".new_house_order_block").on("change","input.text_number, select",function(a){b(this)});$(".new_house_order_block").on("click",
"input.state-over",function(a){a.preventDefault();return!1});$(".new_house_order_block").datepicker_pairs({first_picker_class:"checkin_date_picker",second_picker_class:"checkout_date_picker",callback:b})});
$(function(){$(document.body).on("ajax:success",".cancel_order_cmd",function(b,a,c,e){"success"==a.status&&$(a.html).appendTo("body").modal("show")});$(document.body).on("ajax:success",".js-cancel-order-form",function(b,a,c,e){"reload"==a.status?window.location.reload():(console.log(a),window.location=a.url)})});
$(function(){function b(a,b,c,e,d,f){return{width:Math.round(d*c)+"px",height:Math.round(f*e)+"px",marginLeft:"-"+Math.round(d*a)+"px",marginTop:"-"+Math.round(f*b)+"px"}}var a=0;$("#pic_upload_button").click(function(){""!=$("#user_avatar").val()&&$("#avatar_upload_notify").show();return!0});var c,e,d=$(".img180 .img"),f=$(".img180 .img img"),g=$(".img50 .img"),h=$(".img50 .img img"),k=$(".img30 .img"),l=$(".img30 .img img"),m=d.width(),q=d.height(),r=g.width(),s=g.height(),t=k.width(),u=k.height();
$("#cropbox").Jcrop({onChange:function(d){a++;3<a&&(url=$("#cropbox").attr("src"),$(".img180 .img img").attr("src",url),$(".img50 .img img").attr("src",url),$(".img30 .img img").attr("src",url));$("#crop_x").val(d.x);$("#crop_y").val(d.y);$("#crop_w").val(d.w);$("#crop_h").val(d.h);if(0<parseInt(d.w)){var g=r/d.w,k=s/d.h,n=t/d.w,p=u/d.h;f.css(b(d.x,d.y,c,e,m/d.w,q/d.h));h.css(b(d.x,d.y,c,e,g,k));l.css(b(d.x,d.y,c,e,n,p))}},aspectRatio:1,setSelect:[0,0,100,100],allowSelect:!1,minSize:[50,50],boxHeight:250,
boxWidth:250,onRelease:function(){this.setOptions({setSelect:[0,0,100,100]})}},function(){$(".jcrop-holder").hide();var a=this.getBounds();c=a[0];e=a[1];display_bounds=this.getWidgetSize();display_boundx=display_bounds[0];display_boundy=display_bounds[1];c>e?$(".jcrop-holder").css("margin-top",(250-display_boundy)/2+"px"):$(".jcrop-holder").css("margin-left",(250-display_boundx)/2+"px");$(".jcrop-holder").show()})});
$(function(){$("#itinerary_cities").delegate(".close","click",function(){$(this).parent().find("input:checkbox").attr("checked","checked");$(this).parent().hide()});$(".itinerary_schedules").delegate(".close","click",function(){$(this).parent().find(".destroy").val(!0);$(this).parent().hide()});$(".itinerary_schedules").delegate(".schedule_close","click",function(){$(this).parent().find(".schedule_destroy").val(!0);$(this).parent().hide()});$(".section_tabs").on("click",".close",function(){$(this).parent().find("input:checkbox").attr("checked",
"checked");$(this).parent().hide();resort_sections();return!1});$(".daily_trip_spots").on("click",".close",function(){$(this).parent().find(".destroy").val("true");$(this).parent().hide();$(".daily_trip_spots").find("label:visible").each(function(b){$(this).find(".position").val(b+1)})});$(".itinerary_relation_spot").live("focus",function(b){var a=$(this).data("fields"),c=/new_relation_spots/g,e=$(this).parent().prev();yu_spot_autocomplete(".itinerary_relation_spot","/spots/match?type=spot",function(b,
f,g){if(0<f.item.id){var h=(new Date).getTime(),k=$(".itinerary_relation_spot").find("label").size()+1,l={"%NAME%":f.item.value.split(",")[0],"%ID%":f.item.id,"%INDEX%":k};f=a.replace(c,h);f=f.replace(/%\w+%/g,function(a){return l[a]||a});$(e).append(f)}$(g).val("");b.preventDefault()},function(a,b,c){$(c).parent().next().val(0)},function(a,b,c){$(c).parent().next().val(b);$(c).val(a)})});$(".trip_station").live("focus",function(b){var a=$(this).data("fields"),c=/new_stations/g,e=$(this).parent().prev();
yu_spot_autocomplete(".trip_station","/spots/match?type=spot",function(b,f,g){if(0<f.item.id){var h=(new Date).getTime(),k=$(".daily_trip_stations").find("label").size()+1,l=f.item.value.split(",")[0],m={"%NAME%":l,"%KNAME%":l,"%ID%":f.item.id,"%INDEX%":k};f=a.replace(c,h);f=f.replace(/%\w+%/g,function(a){return m[a]||a});$(e).append(f)}$(g).val("");b.preventDefault()},function(a,b,c){$(c).parent().next().val(0)},function(a,b,c){$(c).parent().next().val(b);$(c).val(a)})});$(".section_item",".daily_trip_stations").filter(function(){return"none"!==
$(this).css("display")}).each(function(b){$(".move",this).html(b+1)});$(".daily_trip_stations").sortable({tolerance:"pointer",stop:function(){$(this).find("label:visible").each(function(b){$(this).find(".position").val(b+1)})}});$(".schedule_relation_spots").sortable({tolerance:"pointer",stop:function(){$(this).find("label:visible").each(function(b){$(this).find(".spot_position").val(b+1)})}});$(".new_dt_stations").sortable();(function(){var b=function(){var a=$("#itinerary_cover_cropper");$.ajax({type:"PUT",
url:a.attr("action"),data:a.serialize(),success:function(a){"success"===a.status&&($("#cropper_preview").html('<img src="'+a.url+'" />'),$("#itinerary_sight_photo_ids_str").val(a.id),$("#uploadCover").modal("hide"))}})};$(".itinerary_set_cover_cmd").live("click",function(){b();return!1})})();(function(){data=[];$(".daily_trip_desc").atwho({at:"#",search_key:"name",tpl:'<li data-value="${name}#">${name}</li>',data:data,callbacks:{remote_filter:function(b,a){var c=[];$.getJSON("/search_scaffolds/at_search?resource=Tour,House,Transaction,Spot&term="+
b,function(b){$.each(b,function(a,b){c.push({name:b.value[0]})});a(c)})}}});$("#unselect_radio_button").click(function(){$("input:checked",".nav-tabs").removeAttr("checked");return!1});$("input:radio",".daily_trip_services").click(function(){$(".tab-pane",".tab-content").removeClass("active");var b=$(this).data("id");$("#"+b).addClass("active")})})()});
$(function(){var b=function(a,b){var e="";a.find("> li").each(function(a,b){e+=" ";e+=$(b).find("span").html()});b.val(e)};$(".tag_text_block").on("click",".tag_text_box",function(){$(".tag_text_block .promo_tags_block").show()});$(".tag_text_block").on("click",".remove_tag_cmd",function(){var a=$(this).parents(".tag").attr("class").split(" ").join(".");$(".promo_tags_block").find("."+a).removeClass("disabled");$(this).parents(".tag").remove();b($("ul.tags"),$(".tag_str_result"));return!1});$(".promo_tags_block").on("click",
".tag",function(){if($(this).hasClass("disabled"))return!1;var a=$(this).clone();new_html=a.html();new_html+="<a href='javascritp:;' class='remove_tag_cmd'>x</a>";a.html(new_html);a.appendTo("ul.tags");a=$(this).attr("class").split(" ").join(".");$(".promo_tags_block").find("."+a).addClass("disabled");b($("ul.tags"),$(".tag_str_result"));return!1})});
$(function(){0<$("body.promotion-body").length&&$(window).scroll(function(){700<=$(this).scrollTop()?$(".curtain_down").addClass("show-up"):$(".curtain_down").removeClass("show-up")});$(".curtain_up").bind("click",function(){$("html, body").animate({scrollTop:700},500,function(){});return!1});$(".curtain-slide-up a.icon-promote-top-arrow").hover(function(){$(this).css("opacity","1.0")},function(){$(this).css("opacity","0.6")});$(".curtain_down").bind("click",function(){$("html, body").animate({scrollTop:0},
500,function(){});return!1});$(".promotion-show .lazy img").lazyload({threshold:300,effect:"fadeIn",load:function(){url=$(this).prop("src");$(this).parent().css("background-image","url('"+url+"')");$(this).remove()}})});var remove_player_meta=function(b){$(b).prev("input[type=hidden]").val("1");$(b).closest(".additional-group").addClass("hide").hide()},add_player_meta=function(b,a,c){b=(new Date).getTime();a=new RegExp("new_"+a,"g");$(".player_metas_list").append(c.replace(a,b))};
$(function(){$(".player_metas_list").on({click:function(){$(this).siblings(".js_player_meta_data_validates_option_input").prop("disabled",!$(this).prop("checked"))}},".js_player_meta_data_validates_option_checkbox");$(".player_metas_list").on({click:function(){$(".js_player_meta_data_view_options_list").append($(this).data("html"))}},".js_player_meta_add_data_view_option");$(".player_metas_list").on({change:function(){var b=$(this).parents(".js_player_meta").find(".js_player_meta_data_view_options_group"),
a=$(this).parents(".js_player_meta").find(".js_player_meta_data_input_only_validate");$(this).val()==$(this).data("input-value")?(b.hide(),a.find(":checkbox").prop("disabled",!1),a.show()):(b.show(),a.find(":checkbox").prop("disabled",!0),a.hide())}},".js_player_meta_data_view_options_select")});
$(function(){$(".view_order_chaffers_cmd").bind("ajax:success",function(b,a,c){"success"==a.status?$(a.html).appendTo("body").modal("show"):show_simple_alert("\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")});$(".new_chaffer_form").live("ajax:success",function(b,a,c){"success"==a.status?(b=$(this).siblings(".chaffers_list"),c=$(this).find("#chaffer_content"),$(a.html).prependTo(b).hide().slideDown(300),$(c).val("")):show_simple_alert("\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")})});
$(function(){$(".rate_form").live("ajax:success",function(a,b,e){"success"==b.status?(a=$(this).parent(".rate_form_section"),e=$(a).siblings(".list_field").find(".list"),$(b.html).prependTo(e).hide().slideDown(300),$(a).hide(),$("p.empty_list").remove()):show_simple_alert(b.msg)});$(".rate_reply_form").live("ajax:success",function(a,b,e){"success"==b.status?(a=$(this).find(".reply_text"),$(a).val(""),$(b.html).appendTo($(this).prev(".reply_list")).hide().slideDown(300),$(this).hide()):show_simple_alert(b.msg)});
$(".rate_item").live("hover",function(a){$(this).find(".cmd").toggle()});$(".reply_cmd").live("click",function(a){a=$(this).parents(".bottom_line").siblings(".reply_list");a=$(a).next(".rate_reply_form");$(a).show();$(a).find(".reply_text").focus()});$(".cancel_rate").live("click",function(){$(this).parents(".btn_section").siblings(".content").val("");$(this).parents(".rate_form").data("validator").resetForm()});$(".cancel_reply").live("click",function(){var a=$(this).parents(".rate_reply_form");
$(this).parents(".btn_section").prev(".reply_text").val("");$(a).hide();$(a).data("validator").resetForm();return!1});var b=$(".star").last();$(".star_section").live("mouseout",function(){$(b).prevAll(".star").html("<span class='yicon-star-on'></span>");$(b).html("<span class='yicon-star-on'></span>");$(b).nextAll(".star").html("<span class='yicon-star-off'></span>");$(".star_section .desc").html($(b).attr("data-desc"))});$(".star").live("hover",function(){$(this).prevAll(".star").html("<span class='yicon-star-on'></span>");
$(this).html("<span class='yicon-star-on'></span>");$(this).nextAll(".star").html("<span class='yicon-star-off'></span>");$(".star_section .desc").html($(this).attr("data-desc"))});$(".star").live("mouseup",function(){$(this).siblings(".rate_stars").attr("value",$(this).attr("data-value"));b=$(this)});$(".rate_list_filter_cmd").on("ajax:success",function(a,b,e,d){"success"==e&&(a=$(this).parents(".rate_block"),$(a).find(".list_field").html(b.html),$(a).find(".filter-item.active").removeClass("active"),
$(this).find(".filter-item").addClass("active"))});$(".more_rates_cmd").on("ajax:success",function(a,b,e,d){"success"==e&&($(this).parents(".list_field").find("> .list").replaceWith(b.html),$(this).hide())})});
$(function(){function b(){var a=$(".search_active"),b=$(".header_search_bar .suggestion .item");0<$(a).length&&$(a).removeClass("search_active");0!=e?($($(b)[e-1]).addClass("search_active"),$(".nav_cat_hidden").val($(".search_active").attr("data-cat"))):$(".nav_cat_hidden").val("All")}function a(){$(".header_search_bar .suggestion").hide();$(".nav_search .clear_blue").hide();var a=$(".nav_search .text");""==$(a).val()||$(".nav_search .clear_blue").is(":visible")?$(a).siblings(".clear_gray").hide():
$(a).siblings(".clear_gray").show();$(".search-box").css({"border-bottom-left-radius":"5px","border-bottom-right-radius":"5px"})}var c;0<$(".site_search_filter").length&&(c=$(".site_search_filter").offset().top+19);$(window).on("scroll",function(){var a=$(".site_search_filter");$(this).scrollTop()>=c?($(a).addClass("fixed"),$(".site_search_result").addClass("with_filter_fixed")):($(a).removeClass("fixed"),$(".site_search_result").removeClass("with_filter_fixed"))});$(".site_search_filter .category li").hover(function(){$(this).addClass("fake_active")},
function(){$(this).removeClass("fake_active")});$(".site_search_filter .category li").on("click",function(){var a=$(".site_search_box .search_form");$(a).find(".hidden_cat").val($(this).attr("data-cat"));$(a).submit()});$(".site_search_box .search_btn a").on("click",function(){$(".site_search_box .search_form").submit()});var e=0;$(".nav_search .click_to_search").live("click",function(a){$(".nav_search .search_form").submit()});$(".header_search_bar .suggestion .item").on("hover",function(){$(".nav_search .search_active").removeClass("search_active");
e=0;b()});$(".header_search_bar .suggestion .item").on("mousedown",function(){$(".nav_cat_hidden").val($(this).attr("data-cat"));$(".nav_search .search_form").submit()});$(".nav_search .clear_blue").on("click",function(){a()});var d=$(".header_search_bar .suggestion .item").length+1;$(".nav_search .text").on({blur:function(){a();$(".nav_search .clear_blue").hide()},keydown:function(c){switch(c.which){case 27:a();break;case 40:e=(e+1)%d;b();break;case 38:e=(e-1+d)%d,b()}}});$(".nav_search .clear_gray").on("click",
function(){$(this).siblings(".text").val("");$(this).hide()})});
(function(){$(".text.full").hover(function(b){0>$(b.target).attr("class").indexOf("little-word")&&(blanks=$(".blank",$(this).parent()),shadows=$(".shadow",$(this).parent()),blanks.addClass("shadow").removeClass("blank"),shadows.addClass("blank").removeClass("shadow"),$(".black",$(this).parent()).addClass("white").removeClass("black"),$(".little-word.yicon-little-word-accommodation",$(this).parent()).addClass("yicon-little-word-accommodation-hover").removeClass("yicon-little-word-accommodation"),$(".little-word.yicon-little-word-activity",
$(this).parent()).addClass("yicon-little-word-activity-hover").removeClass("yicon-little-word-activity"),$(".little-word.yicon-little-word-itinerary",$(this).parent()).addClass("yicon-little-word-itinerary-hover").removeClass("yicon-little-word-itinerary"))},function(b){0>$(b.target).attr("class").indexOf("little-word")&&(blanks=$(".blank",$(this).parent()),shadows=$(".shadow",$(this).parent()),blanks.addClass("shadow").removeClass("blank"),shadows.addClass("blank").removeClass("shadow"),$(".white",
$(this).parent()).addClass("black").removeClass("white"),$(".little-word.yicon-little-word-accommodation-hover",$(this).parent()).addClass("yicon-little-word-accommodation").removeClass("yicon-little-word-accommodation-hover"),$(".little-word.yicon-little-word-activity-hover",$(this).parent()).addClass("yicon-little-word-activity").removeClass("yicon-little-word-activity-hover"),$(".little-word.yicon-little-word-itinerary-hover",$(this).parent()).addClass("yicon-little-word-itinerary").removeClass("yicon-little-word-itinerary-hover"))});
$(".text.full .little-word").hover(function(b){b.stopPropagation()},function(b){b.stopPropagation()})})();
$(function(){(function(){$(".new_suggest_cmd").live("ajax:success",function(b,a,c,e){"success"==a.status&&$(a.html).appendTo("body").modal("show")});$(".new_suggest_form").live("ajax:success",function(b,a,c,e){"success"==a.status?($(".modal.in").modal("hide"),$(a.html).appendTo("body").modal("show")):show_simple_alert("\u63d0\u4ea4\u5931\u8d25\uff01\u8bf7\u91cd\u8bd5\u6216\u53d6\u6d88\uff01")})})();(function(){var b=$(".js-footer-agent-popover-wrapper");$(".js-footer-agent").popover({html:!0,placement:"left",
trigger:"hover",title:"",content:function(){return b.html()},container:"body"})})();(function(){$(".js-footer-agent").affix({offset:{top:function(){return document.body.scrollHeight-800}}})})();(function(){var b=$(".yicon-footer-weixin-blue"),a=$(".js-footer-agent");$(".js-footer-agent").mouseover(function(){a.addClass("footer-agent--mouseover");b.removeClass("yicon-footer-weixin-blue");b.addClass("yicon-footer-weixin-white")});$(".js-footer-agent").mouseout(function(){a.removeClass("footer-agent--mouseover");
b.removeClass("yicon-footer-weixin-white");b.addClass("yicon-footer-weixin-blue")})})()});
$(function(){$(".favorite_block").on("mouseenter",".favorite_cmd",function(a){$(this).hasClass("favorited")&&($(this).hasClass("cancel-hover")||$(this).removeClass("favorited").addClass("favorited-hover"));$(this).hasClass("not-favorited")&&$(this).removeClass("not-favorited").addClass("not-favorited-hover")});$(".favorite_block").on("mouseleave",".favorite_cmd",function(a){$(this).hasClass("favorited-hover")&&$(this).removeClass("favorited-hover").addClass("favorited");$(this).hasClass("not-favorited-hover")&&
$(this).removeClass("not-favorited-hover").addClass("not-favorited")});$(".favorite_cmd").live("ajax:success",function(a,b,e,d){$(this).replaceWith(b.html);_new_icon=$(".favorite_cmd");$(_new_icon).addClass("cancel-hover");$(_new_icon).mouseleave(function(a){$(_new_icon).removeClass("cancel-hover")})});$(".my_favorite_delete_cmd").live("ajax:success",function(a,b,e,d){item=$(a.currentTarget).parents(".favorite_"+b.favorite_id);item.slideUp("fast",function(){item.remove()})});var b;0<$(".my_favorites_filter").length&&
(b=$(".my_favorites_filter").offset().top+19);$(window).on("scroll",function(){var a=$(".my_favorites_filter");$(this).scrollTop()>=b?($(a).addClass("fixed"),$(".my_favorites_list").addClass("with_filter_fixed")):($(a).removeClass("fixed"),$(".my_favorites_list").removeClass("with_filter_fixed"))});$(".my_favorites_filter .category li").hover(function(){$(this).addClass("fake_active")},function(){$(this).removeClass("fake_active")})});
$(function(){var b=function(a,b,e,d){var f=function(b,c,e){"success"==b.status?$(a).siblings(".coupon_message").text(b.data.coupon_message):"failed"==b.status&&$(a).siblings(".coupon_message").text(b.data.coupon_message)};$.ajax({url:b,dataType:"json",type:"PUT",data:e,success:d||f})};generate_cb_fresh_my_order_item=function(a){return function(b,e,d){$(a).parents(".coupon_input_form").trigger("ajax:success");"success"==b.status?(_new_item=$("#order_"+b.data.order_id).replaceWith(b.html),$(_new_item).children(".coupon_message").text(b.data.coupon_message)):
"failed"==b.status?$(a).siblings(".coupon_message").text(b.data.coupon_message):$(a).siblings(".coupon_message").text("")}};$(".my-order-list").on("change",".coupon_code_input",function(){var a=$(this).val(),a=a.trim();if(16==a.length){var c=$(this).parents("form"),a=c.data("check-coupon-path"),c=c.serialize();b(this,a,c)}else $(this).siblings(".coupon_message").text("")});$(".check_coupon_unit_price").on("click",function(){send_order_date(this)});$(".my-order-list").on("click",".freeze_coupon_code",
function(){var a=$(this).parents("form"),c=a.data("freeze-coupon-path"),a=a.serialize();b(this,c,a,generate_cb_fresh_my_order_item(this))});$(".my-order-list").on("click",".unfreeze_coupon_code",function(){var a=$(this).parents("form"),c=a.data("unfreeze-coupon-path"),a=a.serialize();b(this,c,a,generate_cb_fresh_my_order_item(this))})});
$(function(){$(".order_cancel_drawback_cmd").live("click",function(b,a,c,e){$(".order_cancel_drawback_modal").detach().appendTo("body").modal("show")});$(".order_require_drawback_cmd").live("click",function(b,a,c,e){b=$(this).data("url");$.ajax({url:b,type:"GET",dataType:"json",success:function(a,b,c){"success"==a.status?($(".new_drawback_modal_"+a.order_id).remove(),$(a.html).appendTo("body").modal("show")):show_simple_alert("\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")}})});$("body").on("click",
".js-new-drawback-submit",function(){$(".js-new-drawback-form").validate({rules:{"drawback[reason]":{required:!0},"drawback[bank_info_name]":{required:!0},"drawback[bank_info_bank]":{required:!0},"drawback[bank_info_number]":{required:!0}},messages:{}})});$(".js_orders_my_drawback_edit_bank_info").live("click",function(){$(".js_orders_my_drawback_bank_info").remove();$(".js_orders_my_drawback_bank_info_hidden").show();$(this).remove()})});
$(function(){function b(a,b){if(!(0>=a.length)){var d=a.find("a").offset().left,f=a.parent().offset().left,d=d-f,f=a.outerWidth();b?$("#cate-bar").css({left:d,width:f}):$("#cate-bar").stop().animate({left:d,width:f},300)}}(function(){$(".brand-logo").on("mouseenter",".blogo__triangle",function(a){$(".brand-logo .blogo__logo").addClass("blogo__logo--hide")});$(".brand-logo").on("mouseleave",function(a){$(".brand-logo .blogo__logo").removeClass("blogo__logo--hide")})})();(function(){$(".js_sherd_header_country_selector").on("mouseenter",
function(a){$(".js_country_selector").addClass("open")});$(".js_sherd_header_country_selector").on("mouseleave",function(a){$(".js_country_selector").removeClass("open")})})();var a=function(){var a={};return function(b,d,f){f||(f="Don't call this twice without a uniqueId");a[f]&&clearTimeout(a[f]);a[f]=setTimeout(b,d)}}();$(".header-cate li").mouseenter(function(){b($(this))}).mouseleave(function(){b($(".header-cate .on"))});$(window).resize(function(c){a(function(){b($(".header-cate .on"))})});
0<$(".header-cate .on").length&&b($(".header-cate .on"),!0);(function(){var a=$(".js-footer-third-weixin-popover");$(".js-footer-third-weixin").popover({html:!0,placement:"top",trigger:"hover",title:"",content:function(){return a.html()},container:"body"})})()});
$(function(){$("#day_trip_segment_memorable_reason").inputLimit({limit:$("#day_trip_segment_memorable_reason").data("total")});$("#day_trip_tips input").inputLimit({limit:40});$(window).load(function(){$(".carousel").carousel("pause");var b=$("#day_trip_banner img"),a=$("#day_trip_banner").height()-b.height(),c=b.css("top");a!=c&&b.animate({top:a+"px"},6E3)});$(".add_json_posters").on("click",function(){var b=$(this).data("fields"),a=$($(this).data("target"));a.append(b);a.find(":last").focus()});
(function(){var b=function(){var a=$("#day_trip_cover_cropper");$.ajax({type:"PUT",url:a.attr("action"),data:a.serialize(),success:function(a){"success"===a.status&&($("#cropper_preview").html('<img src="'+a.url+'" />'),$("#day_trip_sight_photo_ids_str").val(a.id),$("#uploadCover").modal("hide"))}})};$(".day_trip_set_cover_cmd").on("click",function(){b();return!1})})();(function(){var b=function(){var a=$("#day_trip_segment_cover_cropper");$.ajax({type:"PUT",url:a.attr("action"),data:a.serialize(),
success:function(a){"success"===a.status&&($("#day_trip_segment_posters_list").append('<li class="template-download nofade span2 poster day_trip_segment-poster day_trip_segment_poster in"><img src="'+a.url+'"><input id="sight_photo_ids" name="day_trip_segment[sight_photo_ids][]" type="hidden" value="'+a.id+'" /><div class="delete"><a class="close" data-type="DELETE" data-url="/sight_photos/'+a.id+'"></a></div></li>'),$("#uploadCover").modal("hide"))}})};$(".day_trip_segment_set_cover_cmd").on("click",
function(){b();return!1})})();$("#segment_go_on").on("click",function(){$("#segment_input").val($("#segment_input").data("go-on"))});$("#segment_next").on("click",function(){$("#segment_input").val($("#segment_input").data("next"))});$("#main_edit_nav_submit").on("click","a",function(){var b=$(".js_main_edit_form");$.ajax({url:b.attr("action")+".json",type:"post",data:b.serialize()});return!0});$("#edit_day_trip_user_info_form").on("submit",function(){$.ajax({url:$(this).attr("action")+".json",type:"post",
data:$(this).serialize(),complete:function(b){show_simple_alert(200==b.status?"\u7528\u6237\u4fe1\u606f\u4fee\u6539\u6210\u529f":"\u7528\u6237\u4fe1\u606f\u4fee\u6539\u5931\u8d25")}});return!1})});
$(function(){$(".drawback_model_select").on("change",function(){var a=$(this).val(),a=$(".js_drawback_mode_desc_"+a).html();$(".js_current_drawback_mode_desc").html(a)});var b=$(".js_form_data");$(".js_cost_price").price_indicator({fish_ratio:b.data("fish-ratio"),fish_fee:b.data("fish-fee")});b=$(".js_form_data");$(".price-input-pairs").price_indicator_pairs({fish_ratio:b.data("fish-ratio"),fish_fee:b.data("fish-fee")})});
$(function(){$(".home_banner_cover").hover(function(){$(".icon-home-banner-slide-prev").addClass("hovered");$(".icon-home-banner-slide-next").addClass("hovered")},function(){$(".icon-home-banner-slide-prev").removeClass("hovered");$(".icon-home-banner-slide-next").removeClass("hovered")})});
$(function(){$(".js_qrcode_share_button").live("click",function(){if($(this).hasClass("disabled"))return!1;$.ajax({url:$(this).data("url"),type:"get",dataType:"json",context:this,beforeSend:function(){$(this).addClass("disabled")},success:function(b){"success"==b.status&&($target=$($(this).data("target")),$target.html(b.html),$target.modal("show"))},complete:function(){$(this).removeClass("disabled")}})})});
$(function(){$(".js_need_more_travel_suit").click(function(b){$.post("/activities/update_suit_count",function(a,b,e){"failed"==a.status?show_simple_alert("\u5927\u9c7c\u5df2\u7ecf\u6536\u5230\u60a8\u7684\u53cd\u9988~"):($(".js_travel_suit_need").text(a.count),show_simple_alert("\u8c22\u8c22\u60a8\u7684\u53cd\u9988\uff01"))})})});var _customEvent="gaRefresh",_replaceWith,_append,_ga;
(function(b){_replaceWith=b.fn.replaceWith;b.fn.replaceWith=function(){var a=b(this).parent(),c=_replaceWith.apply(this,arguments);a.trigger(_customEvent);return c};_append=b.fn.append;b.fn.append=function(){var a=_append.apply(this,arguments);b(this).trigger(_customEvent);return a}})(jQuery);
function getGaData(b,a){var c={};"undefined"==typeof a&&(a="id list name category price position quantity".split(" "));$.each(a,function(a,d){var f=b.data("ga-"+d);"undefined"!=typeof f&&(c[d]=f)});return c}
(function(b){var a=!1;b(".js-ga-house-index").on(_customEvent,function(c){c.stopPropagation();ga("set","&dl",b(".js-ga-houses").data("ga-url"));b(".js-ga-house").each(function(a,c){b(c).data("ga-position",a);var f=getGaData(b(c));f.list="list houses: "+b(".js-ga-houses").data("ga-name");ga("ec:addImpression",f);0<a&&0==a%10&&ga("send","event","ecommerce","list",b(".js-ga-houses").data("ga-name"),{nonInteraction:1})});ga("set","dimension1",b(".js-ga-data").data("ga-country"));ga("send","pageview");
a=!0}).triggerHandler(_customEvent);b(".js-ga-house-index").on("click",".js-ga-house a",function(){ga("set","&dl",b(".js-ga-houses").data("ga-url"));ga("ec:addProduct",getGaData(b(this).parents(".js-ga-house")));ga("ec:setAction","click",{list:"list houses: "+b(".js-ga-houses").data("ga-name")});ga("send","pageview")});b(".js-ga-rooms").on(_customEvent,function(){ga("set","&dl",b(".js-ga-rooms-list").data("ga-url"));b(".js-ga-room").each(function(a,e){var d=getGaData(b(e));d.list="list rooms: "+b(".js-ga-rooms-list").data("ga-name");
ga("ec:addImpression",d)});ga("set","dimension1",b(".js-ga-data").data("ga-country"));ga("send","pageview");a=!0}).triggerHandler(_customEvent);b(".js-ga-rooms").on("click",".js-ga-room",function(){ga("set","&dl",b(".js-ga-rooms-list").data("ga-url"));ga("ec:addProduct",getGaData(b(this)));ga("ec:setAction","click",{list:"list rooms: "+b(".js-ga-rooms-list").data("ga-name")});ga("send","pageview")});b(".js-ga-order-new, .js-ga-mobile-order-new").on(_customEvent,function(a){a.stopPropagation();ga("ec:addProduct",
getGaData(b(this)));ga("ec:setAction","checkout",{step:1})}).triggerHandler(_customEvent);b(".js-ga-order-submit-success, .js-ga-mobile-order-submit-success").on(_customEvent,function(a){a.stopPropagation();a=b(this);var e=a.data("ga-auto-confirm");ga("ec:addProduct",getGaData(a));ga("ec:setAction","checkout",b.extend({step:2,id:a.data("ga-order-id")},e?{option:"auto-confirm"}:{}))}).triggerHandler(_customEvent);b(".js-ga-prepay, .js-ga-mobile-prepay").on(_customEvent,function(a){a.stopPropagation();
a=b(this);ga("ec:addProduct",getGaData(a));ga("ec:setAction","checkout",{step:3,id:a.data("ga-order-id")})}).triggerHandler(_customEvent);b(".js-ga-pay-success, .js-ga-mobile-pay-success").on(_customEvent,function(a){a.stopPropagation();a=b(this);var e=getGaData(a);ga("ec:addProduct",e);ga("ec:setAction","purchase",{id:a.data("ga-order-id"),revenue:a.data("ga-full-price")});"undefined"!=typeof _hmt&&_hmt.push(["_trackOrder",{orderId:a.data("ga-order-id"),orderTotal:a.data("ga-full-price"),item:[{skuId:e.id,
skuName:e.name,category:e.category,Price:e.price,Quantity:e.quantity}]}])}).triggerHandler(_customEvent);b(".js-ga-mobile-houses").on(_customEvent,function(c){c.stopPropagation();c=b(this).data("lastPosition");"undefined"==typeof c&&(c=0);b(".js-ga-mobile-house").each(function(a,c){if(!(b(c).data("ga-position")>=a)){b(c).data("ga-position",a);var f=getGaData(b(c));f.list="list houses: "+b(".js-ga-mobile-houses").data("ga-name");ga("ec:addImpression",f);0<a&&0==a%10&&ga("send","event","ecommerce",
"list",b(".js-ga-mobile-houses").data("ga-name"))}});b(this).data("lastPosition",b(".js-ga-mobile-house").length);ga("send","pageview");a=!0}).triggerHandler(_customEvent);b(".js-ga-mobile-houses").on("click",".js-ga-mobile-house a",function(a){ga("ec:addProduct",getGaData(b(this).parents(".js-ga-mobile-house")));ga("ec:setAction","click",{list:"list houses: "+b(".js-ga-mobile-houses").data("ga-name")});ga("send","pageview")});b(".js-ga-mobile-rooms").on(_customEvent,function(c){b(".js-ga-mobile-room").each(function(a,
c){b(this).data("ga-position",a);var f=getGaData(b(c));f.list="list rooms: "+b(".js-ga-mobile-rooms").data("ga-name");ga("ec:addImpression",f)});ga("send","pageview");a=!0}).triggerHandler(_customEvent);b(".js-ga-mobile-rooms").on("click",".js-ga-mobile-room",function(a){ga("ec:addProduct",getGaData(b(this)));ga("ec:setAction","click",{list:"list rooms: "+b(".js-ga-mobile-rooms").data("ga-name")});ga("send","pageview")});a||"undefined"!=typeof ga&&ga("send","pageview")})(jQuery);"use strict";
var fishui=window.fishui||{};fishui.namespace=function(b){b=b.split(".");var a=fishui;"fishui"===b[0]&&(b=b.splice(1));for(var c=0,e=b.length;c<e;c+=1)"undefined"===typeof a[b[c]]&&(a[b[c]]={}),a=a[b[c]];return a};$.fn.fishui_modal_full=function(b){var a=$(this);"show"==b&&(a.addClass("is-open"),$("body").addClass("is-fishui-modal-full-open"));"hide"==b&&(a.removeClass("is-open"),0>=$(".fishui-modal-full.is-open").size()&&$("body").removeClass("is-fishui-modal-full-open"))};
$.fn.dropdown_select=function(b,a){$.extend({},{},b);$(this).each(function(){var a=$(this),b=a.find(".dselect__text"),d=a.find(".dselect__select");a.on("click",".dselect__item",function(f){f=$(f.currentTarget);var g=f.data("value"),h=f.html();b.html(h);d.val(g);a.find(".dselect__item--active").removeClass("dselect__item--active");f.addClass("dselect__item--active");a.trigger("value_changed",{value:g,label:h})})})};"use strict";fishui.namespace("fishui.loading");
fishui.loading=function(){var b=$('<div class="fishui-loading"><div class="floading__spinner"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div></div>');return{show:function(a){var c=this;$("body").prepend(b).addClass("fishui-loading--open").find(".fishui-loading").on("click",function(){c.hide(a)})},hide:function(a){$(".fishui-loading").unbind("click");a&&a.abort();$("body").removeClass("fishui-loading--open").find(".fishui-loading").remove()}}}();
$.fn.loadMorePaginate=function(b){var a=$.extend({},{disabledClass:"disabled",dataUrlName:"next_page_url",dataResponseName:"html",buttonText:"\u67e5\u770b\u66f4\u591a",loadingButtonText:"\u52a0\u8f7d\u4e2d...",disabledButtonText:"\u5df2\u5168\u90e8\u52a0\u8f7d"},b);$(this).each(function(){var b=$(this);b.on("click",function(e){var d="",f=$(b.data("target"));e.preventDefault();b.data("url")&&0<b.data("url").length&&(d=b.data("url"));!d||0>!d.length||(b.html(a.loadingButtonText),$.ajax({url:d,dataType:"json"}).then(function(d){"success"==
d.status&&(f.append(d[a.dataResponseName]),d[a.dataUrlName]?b.data("url",d[a.dataUrlName]).html(a.buttonText):b.data("url","").html(a.disabledButtonText).addClass(a.disabledClass))}))})})};
