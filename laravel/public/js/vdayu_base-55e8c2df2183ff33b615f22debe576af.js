new function(a){a.fn.setCursorPosition=function(c){if(a(this).get(0).setSelectionRange)a(this).get(0).setSelectionRange(c,c);else if(a(this).get(0).createTextRange){var b=a(this).get(0).createTextRange();b.collapse(!0);b.moveEnd("character",c);b.moveStart("character",c);b.select()}}}(jQuery);
var show_simple_alert=function(a){$("<div class='message' id='temp_flash'><div class='message-inside'><span class='message-text'>"+a+"</span><a class='dismiss' href='#'>\u00d7</a></div></div>").prependTo(".header");setTimeout(function(){$("#temp_flash").remove()},4E3)},show_modal_alert=function(a){$("<div class='modal fade price-modal-fade js-price-modal-fade' id='temp_modal' style='display:none'><div class='success-tips'>"+a+"</div></div>").prependTo(".header");$("#temp_modal").modal("show");setTimeout(function(){$("#temp_modal").modal("hide");
$("#temp_modal").remove()},2E3)},load_image=function(a){if("undefined"!==typeof a&&null!=a){var c=new Image(1,1);c.onload=function(){c.onload=null};c.src=a}},yu_spot_autocomplete=function(a,c,b,d,f){$(a).autocomplete({source:c,minLength:1,delay:300,autoFocus:!0,search:function(a,b){$(this).nextAll(".search").addClass("loading")},select:function(a,c){var d=$(this);b(a,c,d);"new_spot"==c.item.place_type&&$.ajax({url:"/spots/new",dataType:"json",type:"GET",data:{name:$(d).val()},success:function(a,b,
c){"success"==a.status?($(".new-spot-modal").remove(),$(a.html).appendTo("body"),$(".new-spot-modal").last().modal("show"),$(d).data({new_spot_callback:f}),$(".modal.in").find("form").append("<input type=hidden name='ac_field' value='#"+d.attr("id")+"'>"),$(".chosen-select").chosen({allow_single_deselect:!1}),gmap_page_initialize()):show_simple_alert("\u64cd\u4f5c\u5931\u8d25, \u8bf7\u91cd\u8bd5");return!1}});$(this).blur()},open:function(a,b){$(this).nextAll(".search").removeClass("loading")},change:function(a,
b){var c=$(this);null==b.item&&d(a,b,c)}}).on("focus",function(){$(this).autocomplete("search","")});$(a).bind("input.autocomplete",function(){$(this).trigger("keydown.autocomplete")})};
$.fn.inputLimit=function(a){var c=$.extend({},{limit:140,errorCls:"error"},a);a=$(this);var b;if(1>$("#vdayu_tip_limit_widget").length){var d=$('<div id="vdayu_tip_limit_widget" class="input-limit-info"></div>');$("body").append(d)}a.live("focus",function(){var a=$(this);b=setInterval(function(){_that=a;dom=$("#vdayu_tip_limit_widget");dom.css({top:_that.offset().top-dom.innerHeight()+"px",left:_that.offset().left+_that.innerWidth()-dom.innerWidth()+"px"});var b;b=a.val();var d=0;if(""!=b)for(var h=
0;h<b.length;h++)d=128<b.charCodeAt(h)?d+1:d+.5;b=parseInt(d,10);dom.html("<span>"+b+"</span>/"+c.limit).show();b>c.limit?(dom.addClass(c.errorCls),_that.addClass(c.errorCls)):(dom.removeClass(c.errorCls),_that.removeClass(c.errorCls))},500)});a.live("blur",function(){clearInterval(b);dom.hide()})};$.fn.numeric_only=function(){$(this).keypress(function(a){if(!a.charCode)return!0;if(57<a.which||48>a.which)return!1})};
$.fn.textQuickChange=function(a,c){var b=$(this),d=".minus",f=".plus";switch($.extend({},{theme:"default"},a).theme){case "inbox":var e;e="<div class='icons'><span class='plus-inbox yicon yicon-num-plus'></span><span class='minus-inbox yicon yicon-num-minus'></span></div>";d=".minus-inbox";f=".plus-inbox";b.wrap("<div class='text-quick-change'>");b.after(e);break;default:e="<span class='plus'> + </span>",b.before("<span class='minus'> - </span>").after(e)}b.on("change",function(){var a=parseInt($(this).val()),
b=$(this).data("max-num"),c=$(this).data("min-num");void 0===c&&(c=1);void 0===b&&(b=null);a<c?($(this).val(c),$(this).trigger("lowerOverflow")):null!=b&&a>b&&($(this).val(b),$(this).trigger("overflow"));$(this).trigger("numChange")});b.change();b.numeric_only();b.parent().on("click",d,function(){var a=+b.val();b.val(a-1);b.change()});b.parent().on("click",f,function(){var a=+b.val();b.val(a+1);b.change()});return this};
$.fn.yu_select=function(){var a=$(this);a.wrap("<a class='yu-select yu_select'>");a.before("<span class='cur-option cur_option'></span>").before("<span class='toggle-icon'><span class='yicon yicon-num-minus'></span></span>");var c=a.siblings(".cur_option");c.html(a[0].selectedOptions[0].text);a.on("change",function(){c.html(this.selectedOptions[0].text);$(this).change});return this};
$.fn.datepicker_with_text=function(a,c){var b=$(this),d=$.extend({},{format:"yyyy-mm-dd",weekStart:1,language:"zh-CN",beforeShowDay:function(a){var b=new Date,b=new Date(b.getFullYear(),b.getMonth(),b.getDate(),0,0,0,0);alert($(this));return a.valueOf()<b.valueOf()?"disabled":""}},a);b.datepicker(d);var f=[],d="."+b.data("text-target");$(d).find("span").each(function(){var a=$(this).data("date"),b=$(this).data("text");f[a]=b});var e=function(a){$(".datepicker").addClass("datepicker_with_text");alert(e.caller);
$(".datepicker td.day").wrapInner("<div class='num'>");$(".datepicker td .num").each(function(a,b){});a="<div class='text'>"+f[""]+"</div>";$(".datepicker td .num").after(a)};b.on("show",function(){0==$(".datepicker td.day").find("div.num").size()&&e()});b.on("changeDate",e)};
$.fn.datepicker_pairs=function(a){$(this).each(function(c,b){var d=$(b),f=$.extend({},{delay_days:1,disable_past:!0,first_picker_class:"first_picker",second_picker_class:"second_picker",second_picker_is_behind_a_day:!1,second_picker_not_later_then_first:!0,callback:function(){}},a),e=new Date,g=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0),h={format:"yyyy-mm-dd",language:"zh-CN",weekStart:1,beforeShowDay:function(a){return f.disable_past&&a.valueOf()<g.valueOf()?"disabled":""}};_startDate=
new Date;f.second_picker_not_later_then_first&&(_startDate=new Date(d.find("."+f.first_picker_class).val()));var l={startDate:_startDate},e=$.extend({},h,{}),h=$.extend({},h,l),m=d.find("."+f.first_picker_class).datepicker(e),k=d.find("."+f.second_picker_class).datepicker(h);m.on("changeDate",function(a){if(f.second_picker_is_behind_a_day||m.datepicker("getDate")>k.datepicker("getDate"))a=m.datepicker("getDate"),a.setDate(a.getDate()+f.delay_days),k.datepicker("update",a);f.second_picker_not_later_then_first&&
(a=m.datepicker("getDate"),a.setDate(a.getDate()+1),k.datepicker("setStartDate",a));m.datepicker("hide");k.datepicker("show")});k.on("changeDate",function(a){k.datepicker("hide");f.callback(k)})})};
$.fn.yu_input_preview=function(){var a=$(this);a.wrap("<div class='yu-input-preview'>");a.after("<div class='lbl'>");a.on("input propertychange",function(){for(var a=$(this).parents(".yu-input-preview").find(".lbl"),b=$(this).val(),d=0;d<b.length;)b=b.substring(0,d+4)+" "+b.substr(d+4),d+=5;$(a).html(b);""==b?$(a).hide():$(a).show();b=$(this).width();$(a).css("min-width",b)});a.blur(function(){var a=$(this).parents(".yu-input-preview").find(".lbl");$(a).hide()})};
$.fn.yu_flow_nav=function(a){$(this).each(function(c,b){var d=$(b),f=$.extend({},{fix_width:!0},a),e=$(d).offset().top,g;f.fix_width&&(g=$(d).width());$(d).affix({offset:{top:e}});$(window).scroll(function(){0<=$(window).scrollTop()-e&&!$(d).is(".yu_flow_nav_affix")?($(d).trigger("yu_flow_nav_affix"),f.fix_width&&$(d).css("width",g),$(d).addClass("yu_flow_nav_affix")):0>$(window).scrollTop()-e&&$(d).is(".yu_flow_nav_affix")&&($(d).trigger("yu_flow_nav_top"),$(d).removeClass("yu_flow_nav_affix"))})})};
var remove_waterflow_sight=function(a){a=$("#wf_sight_"+a);var c=a.parents(".section-wrapper");a.remove();0==c.find(".item").length&&(c.prev(".viewTime").remove(),c.remove());c.find(".item").removeClass("boxLeft boxRight");c.masonry("reload");Arrow_Points(c);return!1},alertFallback=!1;if("undefined"===typeof console||"undefined"===typeof console.log)console={},console.log=alertFallback?function(a){alert(a)}:function(){};
$(function(){$("body").on("touchstart.dropdown",".dropdown-menu",function(a){a.stopPropagation()});(function(){$(".select_place_cmd").click(function(a){$(".search_box_options").toggle();$(this).addClass("active");a.stopPropagation()});$(document).click(function(a){$(a.target).parents(".search_box_options").size()||"block"!=$(".search_box_options").css("display")||($(".select_place_cmd").removeClass("active"),$(".search_box_options").hide())})})();(function(){var a=function(a){return $.ajax({url:a,
dataType:"json",type:"GET",success:function(a,c,f){$("header .message-box-layer").remove();$(a.html).appendTo("header .container")}})};0<$(".user_logged_in").length&&(a("/notification_managements/message"),setInterval(function(){a("/notification_managements/message")},6E4))})();$(".chosen-select").chosen({width:"150px"});$(".lazy img").lazyload({threshold:300,effect:"fadeIn"});$(".carousel").bind("slid",function(){$(".active.item",this).find(".lazy img").each(function(a,c){$(c).attr("src",$(c).data("original"))})});
$('a[data-toggle="pill"]').on("shown",function(a){$(".tab-pane.active").find(".lazy img").each(function(a,b){$(b).attr("src",$(b).data("original"))})});$(".more_cmd",".more_content").live("click",function(a){var c=$(this).parents(".more_content");a=c.find(".short");c=c.find(".all");a.is(":visible")?(a.hide(),c.show()):(c.hide(),a.show())});$("[rel=tooltip]").tooltip({html:!0});$("header").on("click",".dismiss",function(a){$(this).parents(".message").fadeOut().remove()});$.each($("[rel=text_number]"),
function(a,c){$(c).textQuickChange({theme:"inbox"})});$('<div id="loading" class="message" style="display:none"> <div class="message-inside"> <span class="message-text">\u52a0\u8f7d\u4e2d, \u8bf7\u7a0d\u540e...</span> </div> </div>').prependTo("body").bind("ajaxSend",function(a,c,b){"/notification_managements/message"==b.url||0==b.url.indexOf("/places/weather")||0==b.url.indexOf("/spots/match")||0==b.url.indexOf("/cities/match")||0==b.url.indexOf("/places/hotsearch")||0==b.url.indexOf("/explore")||
0==b.url.indexOf("/suggests/new")||0==b.url.indexOf("/favorites")||0==b.url.indexOf("/notifications/update_close_time")||0==b.url.indexOf("/admin/orders")||b.url.match(/\/spots\/.*\/card$/)||b.url.match(/\/activities\/.*\/meta/)||b.url.match(/\/orders.*\/unit_price/)||$(this).show()}).bind("ajaxComplete",function(a,c){$(this).hide()}).bind("ajaxSuccess",function(a,c){$(this).hide()});$(".black-bg-modal").live("shown",function(){$(".modal-backdrop").addClass("black-bg")});$(".date-picker").datepicker({format:"yyyy-mm-dd",
language:"zh-CN",weekStart:1});$(".carousel").carousel({interval:3E4});$(".return_cmd").bind("click",function(){history.back()});(function(){$(window).scroll(function(){100<$(this).scrollTop()?$(".scrollup").fadeIn():$(".scrollup").fadeOut()});$(".scrollup").click(function(){$("html, body").animate({scrollTop:0},600);return!1})})();(function(){var a=function(a){return $.ajax({url:"/cities/get_by_country?country_id="+a,dataType:"json",type:"GET",success:function(a,c,f){city_el=$("#city_id");city_el.empty();
city_el.append(new Option("",""));for(i=0;i<a.length;i++)city_el.append(new Option(a[i].name,a[i].id));city_el.trigger("chosen:updated")}})};$(".city_selector #country_id").live("change",function(c){a($(c.target).val())})})();0<$("#message-drawer").find(".message").size()&&setTimeout(function(){$("#message-drawer").fadeOut()},4E3);$(".richedit_output a").click(function(){$(this).attr("target","_blank")});$("ul.posters_list").sortable({items:">li"});(function(){var a=$(".place_nav");if(!a.hasClass("disable_fixed")&&
a.size()){var c=a.offset().top;$(window).scroll(function(){(void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop)>=c?a.addClass("fixed"):a.removeClass("fixed")})}})();$(".yu_share_block .icon-share").next(".share-list");(function(){var a=function(a){return $.ajax({url:"/notifications/update_close_time",dataType:"json",type:"POST",data:{type:a},success:function(a,c,f){}})};$("header").on("click",".message-box-close",function(c){type_list=
[];$.each($(this).parents(".message").find("li"),function(a,c){var f=$(c).data("type");type_list.push(f)});a(type_list)})})();$(".qrcode[rel=popover]").popover({html:!0,trigger:"hover",placement:"top",title:"\u5fae\u4fe1\u516c\u4f17\u5e10\u53f7: \u5927\u9c7c\u81ea\u52a9\u6e38",content:$(".weixin_popover_wrapper").html()});$(".upgrade-browser").on("click",".dismiss",function(){$(this).parents(".upgrade-browser").hide()});(function(){$(".search_suppliers").sortable({stop:function(){$(this).find(".resource_position").each(function(a){$(this).val(a+
1)})}});$(".search_suppliers").on("click",".close",function(){$(this).parent().find(".resource__destroy").val("true");$(this).parent().hide()});$(".auto_supplier").live("focus",function(a){var c=$(this).data("fields");a="/search_scaffolds/search?resource="+$(this).data("resource");var b=$(this).prev(),d=/new_suppliers/g;$(this).autocomplete({appendTo:"#supplier_auto_complete",source:a,minLength:2,delay:1E3,autoFocus:!0,select:function(a,e){if(0<e.item.id){var g=(new Date).getTime(),h=$(".search_suppliers").find("label").size()+
1,l={"%NAME%":e.item.value,"%CLASS%":e.item.kclass,"%ID%":e.item.id,"%INDEX%":h},g=c.replace(d,g),g=g.replace(/%\w+%/g,function(a){return l[a]||a});$(b).append(g)}$(this).val("");a.preventDefault()},change:function(a,b){null==b.item&&$(this).val("")}}).on("focus",function(){$(this).autocomplete("search","")})})})();(function(){$(".manual_recommend_items").sortable({stop:function(){$(this).find(".resource_position").each(function(a){$(this).val(a+1)})}});$(".manual_recommend_items").on("click",".close",
function(){$(this).parent().find(".resource__destroy").val("true");$(this).parent().hide()});$(".auto_manual_recommend_item").live("focus",function(a){var c=$(this).data("fields");a="/search_scaffolds/search?resource="+$(this).data("resource");var b=$(this).prev(),d=/new_item/g;$(this).autocomplete({appendTo:"#manual_recommend_items_auto_complete",source:a,minLength:2,delay:1E3,autoFocus:!0,select:function(a,e){if(0<e.item.id){var g=(new Date).getTime(),h=$(".manual_recommend_items").find("label").size()+
1,l={"%NAME%":e.item.value,"%CLASS%":e.item.kclass,"%ID%":e.item.id,"%INDEX%":h},g=c.replace(d,"new_item["+g+"]"),g=g.replace(/%\w+%/g,function(a){return l[a]||a});$(b).append(g)}$(this).val("");a.preventDefault()},change:function(a,b){null==b.item&&$(this).val("")}}).on("focus",function(){$(this).autocomplete("search","")})})})();(function(){$(document).ready(function(){$(".city-path:last",".cities").css("border-left","6px solid transparent")})})();$(".timepicker").timepicker({amPmText:["\u4e0a\u5348",
"\u4e0b\u5348"],hourText:"\u5c0f\u65f6",minuteText:"\u5206\u949f"})});$(function(){var a=$(".yu-column-two .left-column"),c=$(".yu-column-two .right-column"),b=$(".pagination");pager_height=0<b.size()?b.outerHeight(!0):0;c.height()<a.height()-pager_height&&c.height(a.height()-pager_height)});
Date.prototype.format=function(a){var c={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),"S+":this.getMilliseconds()};/(y+)/i.test(a)&&(a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var b in c)(new RegExp("("+b+")")).test(a)&&(a=a.replace(RegExp.$1,1==RegExp.$1.length?c[b]:("00"+c[b]).substr((""+c[b]).length)));return a};
$.fn.auto_change_near_cost_price=function(a){var c=$(this),b=$.extend({},{fish_ratio:.1,fish_fee:0},a);b.fish_ratio=parseFloat(b.fish_ratio);b.fish_fee=parseInt(b.fish_fee);var d=function(a){var c=+$(a.target).val(),c=Math.round((c-b.fish_fee)/(1+b.fish_ratio));a=a.target;var d=$(a).parents(".js_price_block").find(".js_auto_change_cost_price_hidden_field");$(a).parents(".js_price_block").find(".js_auto_change_cost_price").html(c);d.val(c)};$.each(c,function(a,b){$(b).bind("focus",d);$(b).bind("textchange",
d)})};$.fn.near_price_indicator=function(a,c){var b=$(this),d=$.extend({},{fish_ratio:.1,fish_fee:0},a);d.fish_ratio=parseFloat(d.fish_ratio);d.fish_fee=parseInt(d.fish_fee);var f=function(a){var b=+$(a.target).val(),b=Math.round(b*(1+d.fish_ratio)+d.fish_fee);$(a.target).parents(".js_price_block").find(".js_selling_price").html(b)};$.each(b,function(a,b){$(b).bind("focus",f);$(b).bind("textchange",f)})};
$.fn.price_indicator=function(a,c){var b=$(this),d=$.extend({},{fish_ratio:.1,fish_fee:0},a);d.fish_ratio=parseFloat(d.fish_ratio);d.fish_fee=parseInt(d.fish_fee);var f=doT.template("<div class='{{= it.css_class}}'> \u4f63\u91d1\u6bd4\u4f8b: <span class='ratio'>{{= it.fish_ratio}}</span> \u670d\u52a1\u8d39: <span class='fee'>{{= it.fish_fee}}</span> <br> \u5ba2\u62a5\u4ef7: <span class='num'>{{= it.price}}</span> </div>")({css_class:"selling_price_tip",price:0,fish_ratio:d.fish_ratio,fish_fee:d.fish_fee}),
e=function(a){a=+$(a.target).val();a=Math.round(a*(1+d.fish_ratio)+d.fish_fee);var b=$(".selling_price_tip");1>b.length&&$("body").append(f);selling_num=$(".selling_price_tip .num");selling_num.html(a);b.show()},g=function(a){$(".selling_price_tip").hide()};$.each(b,function(a,b){$(b).bind("focus",e);$(b).bind("textchange",e);$(b).bind("blur",g)})};
$.fn.price_indicator_pairs=function(a,c){var b=$(this),d=$.extend({},{fish_ratio:.1,fish_fee:0},a);d.fish_ratio=parseFloat(d.fish_ratio);d.fish_fee=parseInt(d.fish_fee);var f=function(a){var b=+$(a.target).val(),b=Math.round((b-d.fish_fee)/(1+d.fish_ratio));a=$(a.target).parents(".price-input-pairs").find(".pipairs__cost input[type='text']");$(a).val(b)},e=function(a){var b=+$(a.target).val(),b=Math.round(b*(1+d.fish_ratio)+d.fish_fee);a=$(a.target).parents(".price-input-pairs").find(".pipairs__selling input[type='text']");
$(a).val(b)};$.each(b,function(a,b){$(".pipairs__cost input[type='text']",b).bind("focus",e);$(".pipairs__cost input[type='text']",b).bind("textchange",e);$(".pipairs__selling input[type='text']",b).bind("focus",f);$(".pipairs__selling input[type='text']",b).bind("textchange",f)})};
$(function(){$(".js_qrcode_share_button").live("click",function(){if($(this).hasClass("disabled"))return!1;$.ajax({url:$(this).data("url"),type:"get",dataType:"json",context:this,beforeSend:function(){$(this).addClass("disabled")},success:function(a){"success"==a.status&&($target=$($(this).data("target")),$target.html(a.html),$target.modal("show"))},complete:function(){$(this).removeClass("disabled")}})})});
